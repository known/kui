(function($){$.NZ_Window={show:function(options){var defOptions={content:null,url:null,title:"",type:0,width:600,height:350,maximize:false,scrollbar:{x:false,y:true},operate:{btn_Close:true,btn_Max:true,btn_Refresh:false,btn_NewWindow:false,resize:true},style:{btnColor:"black",titleBarColor:"",bgColor:"#111"},callback:null};if(typeof options=="object"&&options.type==1){defOptions.width="60%";}
var opts=$.extend({},defOptions,options);opts.operate=$.extend({},defOptions.operate,typeof options=="object"?options.operate:{});opts.style=$.extend({},defOptions.style,typeof options=="object"?options.style:{});opts.scrollbar=$.extend({},defOptions.scrollbar,typeof options=="object"?options.scrollbar:{});if(opts.width.toString().indexOf("%")>-1&&opts.type!=1){opts.width=$(window).width()*(parseFloat(opts.width.replace(/%/g,""))/100);}
if(opts.height.toString().indexOf("%")>-1){opts.height=$(window).height()*(parseFloat(opts.height.replace(/%/g,""))/100);}else{opts.height=parseFloat(opts.height);}
var windowid=getWindowGUID();switch(opts.type){case 0:var bg=$("<div class=\"NZ-Window-bg\"></div>");bg.css("background-color",opts.style.bgcolor);var container=$("<div class=\"NZ-Window-normal\"></div>");container.css({width:opts.width,height:opts.height,"left":($(window).width()-opts.width)/2,"top":$(window).height()>opts.height?($(window).height()-opts.height)/2:0});var title=$("<div class=\"NZ-Window-normal-title\"></div>");title.html(opts.title);if($.trim(opts.style.titleBarColor)!=""){title.css("background-color",opts.style.titleBarColor);}
if(opts.style.btnColor=="white"){title.css("color","#fff");}
var con=$("<div class=\"NZ-Window-normal-conLocation NZ-Window-normal-con\"></div>");if(opts.content!=null){con.append(opts.content);container.find(".NZ-Window-normal-con").css({"overflow-x":opts.scrollbar.x,"overflow-y":opts.scrollbar.y});}else if(opts.url!=null){showloading(container);container.on("animationend.loadinit webkitAnimationEnd.loadinit",function(){var thisobj=$(this);container.find(".NZ-Window-normal-con").css("overflow","hidden");var iframe=$("<iframe src=\""+opts.url+"\"></iframe>");iframe.load(function(){thisobj.find(".NZ-Window-normal-loadingbg,.NZ-Window-loading").animate({"opacity":"0"},300,"linear",function(){$(this).remove();});});con.append(iframe);});}
container.append(title).append(con);console.log(opts.operate.resize);if(opts.operate.resize){var resize=$("<div class=\"NZ-Window-normal-resize\"></div>");container.append(resize);Resize(resize,container);}
var operate=$("<ul class=\"NZ-Window-normal-operate\"></ul>");var btn_close=null,btn_max=null,btn_newWindow=null,btn_refresh=null;if(opts.operate.btn_Close){btn_close=$("<li class=\"close "+opts.style.btnColor+"\"></li>");operate.append(btn_close);}
if(opts.operate.btn_Max){btn_max=$("<li class=\"max "+opts.style.btnColor+"\"></li>");operate.append(btn_max);if(opts.maximize){container.data("windowstate","max");var wwidth=$(window).width()*0.7,wheight=$(window).height()*0.7;container.data("windowinitsize",{wwidth:wwidth,wheight:wheight,wleft:($(window).width()-wwidth)/2,wtop:($(window).height()-wheight)/2});container.css({"width":$(window).width(),"height":$(window).height(),left:0,top:0}).find(".max").removeClass("max").addClass("normal");}else{container.data("windowstate","normal");}}
if(opts.operate.btn_Refresh&&opts.url!=null){btn_refresh=$("<li class=\"refresh "+opts.style.btnColor+"\"></li>");operate.append(btn_refresh);}
if(opts.operate.btn_NewWindow&&opts.url!=null){btn_newWindow=$("<li class=\"newWindow "+opts.style.btnColor+"\"></li>");operate.append(btn_newWindow);}
container.append(operate);var zindex=getLayerIndex();container.data("windowid",windowid).addClass("NZ-Window-normal-marchIn").css("z-index",zindex);bg.data("windowid",windowid).addClass("NZ-Window-bg-Motion-In").css("z-index",zindex);$(document.body).append(bg).append(container);title.NHDrag({bydragobj:container});btn_close?btn_close.click({id:windowid},function(event){$.NZ_Window.close(event.data.id,opts.callback);}):null;btn_max?btn_max.click({id:windowid},function(event){$.NZ_Window.Maximize(event.data.id);}):null;btn_refresh?btn_refresh.click({window:container},function(event){if(event.data.window.find("iframe").length>0){showloading(event.data.window);event.data.window.find("iframe").attr("src",event.data.window.find("iframe").attr("src"));}}):null;btn_newWindow?btn_newWindow.click({windowobj:container},function(event){if(event.data.windowobj.find("iframe").length>0){window.open(event.data.windowobj.find("iframe").attr("src"),"_blank");}}):null;break;case 1:var virtualcontainer=$("<div class=\"NZ-Window-panel-virtual\"></div>");var container=$("<div class=\"NZ-Window-panel\"></div>");var bg=$("<div class=\"NZ-Window-bg\"></div>");var close=$("<div class=\"fa fa-remove NZ-Window-panel-Close\"></div>");container.append(close);$(document.body).data("overflow-y",$(document.body).css("overflow-y"));$(document.body).data("overflow-x",$(document.body).css("overflow-x"));$(document.body).css({"overflow-y":"hidden","overflow-x":"hidden"});var zindex=getLayerIndex();bg.css({"z-index":zindex-1,"background-color":"#000","opacity":"0"});container.append(opts.content).css({"width":opts.width}).children().show();virtualcontainer.append(container).css({"z-index":zindex+1});virtualcontainer.mousedown(function(){container.removeClass("NZ-motion-panelIn").addClass("NZ-motion-ghost");container.on("animationend.ghost webkitAnimationEnd.ghost",function(){$(this).removeClass("NZ-motion-ghost");});});container.mousedown(function(e){if(e&&e.stopPropagation){e.stopPropagation();}
else{window.event.cancelBubble=true;}});close.click(function(e){container.addClass("NZ-motion-panelOut");container.bind("animationend.close webkitAnimationEnd.close",function(){virtualcontainer.remove();});bg.animate({opacity:0},800,function(){$(document.body).css({"overflow-y":$(document.body).data("overflow-y"),"overflow-x":$(document.body).data("overflow-x")});$(this).remove();});if(e&&e.stopPropagation){e.stopPropagation();}
else{window.event.cancelBubble=true;}});container.addClass("NZ-motion-panelIn");$(document.body).append(bg);$(document.body).append(virtualcontainer);bg.animate({"opacity":0.5},800);virtualcontainer.scroll(function(){close.css("top",$(this).scrollTop());});break;default:break;}
return windowid;function getLayerIndex(){var index=0;$(document.body).children().each(function(){if(parseInt($(this).css("z-index"))>index){index=parseInt($(this).css("z-index"));}});if(index==0){index=9999;}
return index;}
function getWindowGUID(){return "window"+'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});;}
function Resize(el,obj){var els=$(obj),x=y=0;var shadow=$("<div style=\"position:fixed;width:"+obj.outerWidth()+"px;height:"+obj.outerHeight()+"px;z-index:"+(parseInt($(obj).css("z-index"))+1)+";left:"+$(obj).css("left")+";top:"+$(obj).css("top")+";opacity:0.6; filter:alpha(opacity=60);background-color:#fff;border:1px solid #999;cursor: nwse-resize;\"></div>");$(el).mousedown(function(e){if(obj.outerWidth()<$(window).width()){shadow.css({"width":$(obj).outerWidth()+"px","height":$(obj).outerHeight()+"px","z-index":(parseInt($(obj).css("z-index"))+1),"left":$(obj).css("left"),"top":$(obj).css("top")});shadow.appendTo('body');x=e.clientX-els.outerWidth(),y=e.clientY-els.outerHeight();el.setCapture?(el.setCapture(),el.onmousemove=function(ev){mouseMove(ev||event)},el.onmouseup=mouseUp):($(document).bind("mousemove",mouseMove).bind("mouseup",mouseUp))
e.preventDefault()}});function mouseMove(e){shadow.width(((e.clientX-x)<100)?'100':(($(window).width()-5)<(e.clientX-x)?($(window).width()-5):(e.clientX-x))+'px');shadow.height(((e.clientY-y)<100)?'100':(($(window).height()-5)<(e.clientY-y)?($(window).height()-5):(e.clientY-y))+'px');}
function mouseUp(e){var bw=parseInt(els.css("border-left-width"));var bh=parseInt(els.css("border-bottom-width"));var cw=shadow.width();var ch=shadow.height();els.animate({'width':cw,'height':ch},function(){els.children(".window-content").css({'height':ch-parseInt(els.children(".window-title").height())});if($(this).children(".window-content").children("iframe").length>0){els.children(".window-content").children("iframe").css({"height":ch-parseInt(els.children(".window-title").height()),"width":"100%"});}
shadow.remove();});el.releaseCapture?(el.releaseCapture(),el.onmousemove=el.onmouseup=null):($(document).unbind("mousemove",mouseMove).unbind("mouseup",mouseUp))}}
function showloading(conobj){var wloadingbg=$("<div class=\"NZ-Window-normal-conLocation NZ-Window-normal-loadingbg\"></div>");var wloading=$("<div class=\"NZ-Window-loading\"><div class=\"k-line k-line11-1\"></div><div class=\"k-line k-line11-2\"></div><div class=\"k-line k-line11-3\"></div><div class=\"k-line k-line11-4\"></div><div class=\"k-line k-line11-5\"></div></div>");conobj.append(wloadingbg).append(wloading);}},close:function(windowid,callback){if(typeof windowid=="undefined"||windowid==null||windowid==""){return;}
var windowobj=null,bgobj=null;$(".NZ-Window-normal").each(function(){if($(this).data("windowid")==windowid){windowobj=$(this);return false;}});$(".NZ-Window-bg").each(function(){if($(this).data("windowid")==windowid){bgobj=$(this);return false;}});windowobj.removeClass("NZ-Window-normal-marchIn").addClass("NZ-Window-normal-marchOut");bgobj.removeClass("NZ-Window-bg-Motion-In").addClass("NZ-Window-bg-Motion-Out");windowobj.on("animationend.close webkitAnimationEnd.close",function(){$(this).remove();if(typeof callback=="function"){callback();}});bgobj.on("animationend.close webkitAnimationEnd.close",function(){$(this).remove();});},Maximize:function(windowid){if(typeof windowid=="undefined"||windowid==null||windowid==""){return;}
var windowobj=null;$(".NZ-Window-normal").each(function(){if($(this).data("windowid")==windowid){windowobj=$(this);return false;}});if(windowobj){var windowstate="normal";if(windowobj.data("windowstate")=="normal"){windowobj.data("windowinitsize",{wwidth:windowobj.width(),wheight:windowobj.height(),wleft:windowobj.css("left"),wtop:windowobj.css("top")});windowobj.animate({width:$(window).width(),height:$(window).height(),left:0,top:0},350,function(){windowobj.data("windowstate","max");windowobj.find(".max").removeClass("max").addClass("normal");});}else{windowobj.animate({width:windowobj.data("windowinitsize").wwidth,height:windowobj.data("windowinitsize").wheight,left:windowobj.data("windowinitsize").wleft,top:windowobj.data("windowinitsize").wtop},350,function(){windowobj.data("windowstate","normal");windowobj.find(".normal").removeClass("normal").addClass("max");});}}}};})(jQuery);