function DevCode(){var i={GetModels:sysBaseUrl+"/Develop/GetModels"},t=new Tree("tree",{url:i.GetModels,onClick:function(t){t.children||n.setModel(t.id)}}),n=new DevCodeForm(t),r=new Tabs({fit:!0,items:[{name:"领域模型",component:n},{name:"前端代码",component:'<pre id="codeView" class="code"><\/pre>'},{name:"实体代码",component:'<pre id="codeEntity" class="code"><\/pre>'},{name:"控制器代码",component:'<pre id="codeController" class="code"><\/pre>'},{name:"业务逻辑层",component:'<pre id="codeService" class="code"><\/pre>'},{name:"数据访问层",component:'<pre id="codeRepository" class="code"><\/pre>'},{name:"数据库脚本",component:'<pre id="codeSql" class="code"><\/pre>'}]});this.render=function(n){var i,u,f;Utils.addJs(baseUrl+"/static/libs/prettify/prettify.js");Utils.addJs(baseUrl+"/static/libs/prettify/lang-css.js");i=$('<div class="fit">').appendTo(n);u=$('<div class="fit-col-3">').appendTo(i);t.render().appendTo(u);f=$('<div class="fit-col-7">').appendTo(i);r.render().appendTo(f)};this.mounted=function(){n.bindEnablePaste()}}function DevCodeForm(n){function e(n){for(var i,t=0;t<u.length;t++)i=u[t],Utils.createButton(i).appendTo(n)}function o(n){Utils.paste(n,function(n){for(var e,h,i,u,o=[],s=t.columns,f=n.split("\n"),r=0;r<f.length;r++)if(f[r].length){for(e={},h=f[r].split("\t"),i=0;i<s.length;i++)u=s[i+1],u&&u.field&&(e[u.field]=h[i]);o.push(e)}t.setData(o)})}var r={GetModel:sysBaseUrl+"/Develop/GetModel",SaveModel:sysBaseUrl+"/Develop/SaveModel",DeleteModel:sysBaseUrl+"/Develop/DeleteModel"},f=this,u=[{text:"新建",icon:"fa fa-plus",handler:function(){i.clear();t.setData([]);$("pre").html("")}},{text:"保存",icon:"fa fa-save",style:"primary",handler:function(){i.save(r.SaveModel,function(t){n.reload();f.setModel(t.Id)})}},{text:"删除",icon:"fa fa-trash-o",style:"danger",handler:function(){Layer.confirm("确定要删除该模型吗？",function(){Ajax.post(r.DeleteModel,{id:i.Id.getValue()},function(){n.reload()})})}},{text:"导出",icon:"fa fa-sign-out",handler:function(){var n=new GridManager(t,null,[]);n.export()}},{text:"复制",icon:"fa fa-copy",handler:function(){var u=t.getData(),f,i,r,e,n,o,s;if(u.length===0){Layer.tips("暂无数据可复制！");return}for(f=[],i=t.columns,r=0;r<u.length;r++){for(e=[],n=0;n<i.length;n++)i[n].export&&(o=u[r][i[n].field],e.push(o));f.push(e.join("\t"))}s=f.join("\n");Utils.copy(s);Layer.tips("复制成功！")}}],i=new Form("Domain",{style:"form3",labelWidth:80,fields:[{field:"Id",type:"hidden"},{title:"系统",field:"System",type:"select",code:["开发平台","微型ERP平台","水质监测平台","水质检测平台","实验室平台"],required:!0},{title:"类别",field:"Category",type:"text",required:!0},{title:"表前缀",field:"Prefix",type:"text",required:!0},{title:"代码",field:"Code",type:"text",required:!0},{title:"名称",field:"Name",type:"text",required:!0},{title:"选项",field:"chkPaste",type:"checkbox",code:[{Code:"1",Name:"启用粘贴批量导入"}]}],setData:function(n){var i=[];n.data.FieldData&&(i=JSON.parse(n.data.FieldData));t.setData(i)},onSaving:function(n){var i=t.getData();n.FieldData=JSON.stringify(i)}}),t=new Grid("Field",{edit:!0,row:{Type:"string",Length:50},columns:[{action:"add",icon:"fa fa-plus",align:"center",width:"60px",actionFormat:function(){return'<span class="link red fa fa-trash-o" action="remove" title="删除"><\/span> <span class="link fa fa-arrow-up" action="up" title="上移"><\/span> <span class="link fa fa-arrow-down" action="down" title="下移"><\/span>'}},{title:"名称",field:"Name",type:"text",width:"100px","export":!0},{title:"编码",field:"Code",type:"text",width:"100px","export":!0},{title:"类型",field:"Type",type:"select",code:["string","int","decimal","date"],width:"80px","export":!0},{title:"长度",field:"Length",type:"text",width:"50px","export":!0},{title:"必填",field:"Required",type:"checkbox",width:"40px",align:"center","export":!0},{title:"查询",field:"Query",type:"checkbox",width:"40px",align:"center","export":!0},{title:"控件",field:"Control",type:"select",code:["hidden","text","textarea","radio","checkbox","select","date","editor","html","picker"],width:"100px","export":!0},{title:"代码表",field:"Codes",type:"text","export":!0},]});this.render=function(){var n=$('<div class="fit">'),r=$('<div style="padding:5px;">').appendTo(n);return e(r),i.render().appendTo(n),t.render().css({top:"120px",overflow:"auto"}).appendTo(n),n};this.setModel=function(n){Ajax.get(r.GetModel,{id:n},function(n){var t,r;i.setData(n.Model);for(t in n)r=$("#code"+t).addClass("prettyprint source linenums"),r.length&&r.html("<code>"+n[t]+"<\/code>");prettyPrint()})};this.bindEnablePaste=function(){$('[name="chkPaste"]').change(function(){o($(this)[0].checked)})}}function DevDocView(){var n=new Tree("tree",{data:[{id:"ui",pid:"0",name:"前端文档",open:!0},{id:"uiLayout",pid:"ui",name:"布局"},{id:"uiLayer",pid:"uiLayout",name:"树(Tree)",url:"/ui/Tree.html"},{id:"uiLayer",pid:"uiLayout",name:"视图(View)",url:"/ui/View.html"},{id:"uiGrid",pid:"uiLayout",name:"网格(Grid)",url:"/ui/Grid.html"},{id:"uiForm",pid:"uiLayout",name:"表单(Form)",url:"/ui/Form.html"},{id:"uiField",pid:"uiLayout",name:"字段(Field)",url:"/ui/Field.html"},{id:"uiControl",pid:"ui",name:"控件"},{id:"uiInput",pid:"uiControl",name:"通用控件(Input)",url:"/ui/control/Input.html"},{id:"uiCheckBox",pid:"uiControl",name:"复选框(CheckBox)",url:"/ui/control/CheckBox.html"},{id:"uiCheckBoxList",pid:"uiControl",name:"复选框列表(CheckBoxList)",url:"/ui/control/CheckBoxList.html"},{id:"uiRadioBoxList",pid:"uiControl",name:"单选框列表(RadioBoxList)",url:"/ui/control/RadioBoxList.html"},{id:"uiSelectList",pid:"uiControl",name:"下拉列表(SelectList)",url:"/ui/control/SelectList.html"},{id:"uiListBox",pid:"uiControl",name:"列表框(ListBox)",url:"/ui/control/ListBox.html"},{id:"uiLayer",pid:"ui",name:"弹层(Layer)",url:"/ui/Layer.html"},{id:"uiFrame",pid:"ui",name:"框架(Frame)",url:"/ui/Frame.html"},{id:"back",pid:"0",name:"后端文档",open:!0},{id:"backKnown",pid:"back",name:"Known",url:"/back/known.html"},{id:"backKnownNet",pid:"back",name:"Known.Net",url:"/back/knownnet.html"}],onClick:function(n){if(!n.children){var t=$("#"+n.id).html()||"";$("#content").load(baseUrl+"/docs"+n.url,function(){var n=$("pre.code").addClass("prettyprint source linenums"),t=n.html();n.html("<code>"+t+"<\/code>");prettyPrint()})}}});this.render=function(t){Utils.addJs(baseUrl+"/static/libs/prettify/prettify.js");Utils.addJs(baseUrl+"/static/libs/prettify/lang-css.js");var i=$('<div class="fit doc">').appendTo(t),r=$('<div class="fit-col-3">').appendTo(i);n.render().appendTo(r);$('<div class="fit-col-7" id="content">').appendTo(i)};this.mounted=function(){}}function DevModule(){function e(n,t){var i;Layer.open({title:"添加按钮 - "+n.Name,width:400,height:250,content:'<div id="listButton" style="padding:10px;"><\/div>',success:function(){i=new Input($("#listButton"),{type:"checkbox",code:[{Code:"add",Name:"新增",Data:{Icon:"fa fa-plus",Target:"toolbar",Sort:1}},{Code:"copy",Name:"复制",Data:{Icon:"fa fa-copy",Target:"grid",Sort:2}},{Code:"edit",Name:"编辑",Data:{Icon:"fa fa-edit",Target:"grid",Sort:3}},{Code:"remove",Name:"删除",Data:{Icon:"fa fa-trash-o",Target:"grid,batch",Sort:4}},{Code:"import",Name:"导入",Data:{Icon:"fa fa-sign-in",Target:"toolbar",Sort:5}},{Code:"export",Name:"导出",Data:{Icon:"fa fa-sign-out",Target:"toolbar",Sort:6}},{Code:"-"},{Code:"print",Name:"打印",Data:{Icon:"fa fa-print",Target:"grid",Sort:7}},{Code:"up",Name:"上移",Data:{Icon:"fa fa-arrow-up",Target:"grid",Sort:8}},{Code:"down",Name:"下移",Data:{Icon:"fa fa-arrow-down",Target:"grid",Sort:9}},{Code:"upload",Name:"上载",Data:{Icon:"fa fa-upload",Target:"toolbar",Sort:10}},{Code:"download",Name:"下载",Data:{Icon:"fa fa-download",Target:"toolbar",Sort:11}},{Code:"-"},{Code:"lock",Name:"锁定",Data:{Icon:"fa fa-lock",Target:"grid,batch",Sort:12}},{Code:"unlock",Name:"解锁",Data:{Icon:"fa fa-unlock",Target:"grid,batch",Sort:13}},{Code:"enable",Name:"启用",Data:{Icon:"fa fa-check-circle-o",Target:"grid,batch",Sort:14}},{Code:"disable",Name:"禁用",Data:{Icon:"fa fa-minus-circle",Target:"grid,batch",Sort:15}},{Code:"-"},{Code:"submit",Name:"提交",Data:{Icon:"fa fa-send-o",Target:"grid,batch",Sort:16}},{Code:"revoke",Name:"撤回",Data:{Icon:"fa fa-reply",Target:"grid,batch",Sort:17}},{Code:"pass",Name:"复核通过",Data:{Icon:"fa fa-check",Target:"grid,batch",Sort:18}},{Code:"fail",Name:"复核退回",Data:{Icon:"fa fa-close",Target:"grid,batch",Sort:19}},{Code:"close",Name:"关闭",Data:{Icon:"fa fa-times-circle-o",Target:"grid,batch",Sort:20}}]})},buttons:[{text:"确定",handler:function(u){var f=i.getData(),e;if(!f.length){Layer.tips("请至少选择一个按钮！");return}e=f.map(function(t){var i=t.Data;return i.AppId=r.code,i.ParentId=n.Id,i.Code=t.Code,i.Name=t.Name,i.Type="button",i.Enabled=1,i});t&&t(e);u.close()}}]})}function u(t,i){var r;Layer.open({title:t,width:350,height:250,content:'<ul id="treeModule"><\/ul>',success:function(){var t=new Tree("treeModule",{data:n.list.filter(function(n){return n.module.Type!=="button"}),onClick:function(n){r=n.module}})},buttons:[{text:"确定",handler:function(n){n.close();i&&i(r)}}]})}function o(t){var i,r=Layer.open({title:"导出SQL",width:450,height:300,content:'<ul id="treeSql"><\/ul>',success:function(){i=new Tree("treeSql",{check:!0,data:n.list,onClick:function(n){copyNode=n.module}})},buttons:[{text:"确定",handler:function(n){n.close();var r=i.getCheckedNodes();t&&t(r)}}]})}function f(i,r){var u=r===1?"启用":"禁用";i.selectRows(function(i){Layer.confirm("确定要"+u+"所选模块？",function(){Ajax.post(t.EnableModules,{data:JSON.stringify(i.ids),enable:r},function(){n.reload()})})})}var t={DeleteModels:sysBaseUrl+"/Develop/DeleteModules",MoveModel:sysBaseUrl+"/Develop/MoveModule",SaveModel:sysBaseUrl+"/Develop/SaveModule",GetDatabaseNames:sysBaseUrl+"/Develop/GetDatabaseNames",ChangeDatabase:sysBaseUrl+"/Develop/ChangeDatabase",GetModuleTree:sysBaseUrl+"/Develop/GetModuleTree",CopyModules:sysBaseUrl+"/Develop/CopyModules",MoveModules:sysBaseUrl+"/Develop/MoveModules",ExportModules:sysBaseUrl+"/Develop/ExportModules",AddModules:sysBaseUrl+"/Develop/AddModules",EnableModules:sysBaseUrl+"/Develop/EnableModules"},r={},n=new Tree("tree",{url:t.GetModuleTree,autoLoad:!1,onLoad:function(n){var t=n||[],r=t.map(function(n){return n.module});i.setGridData(r)},onClick:function(n){r=n.getPath()[0];var t=n.children||[],u=t.map(function(n){return n.module});i.setGridData(u)}}),i=new View("Module",{url:t,left:n,columns:[{field:"Id",type:"hidden"},{field:"AppId",type:"hidden"},{field:"ParentId",type:"hidden"},{title:"编码",field:"Code",width:"80px",type:"text",required:!0},{title:"名称",field:"Name",width:"120px",type:"text",required:!0,format:function(n){return'<i class="'+n.Icon+'"><\/i> '+n.Name}},{onlyForm:!0,title:"图标",field:"Icon",type:"text",required:!0},{title:"类型",field:"Type",width:"80px",type:"radio",code:[{Code:"menu",Name:"菜单"},{Code:"page",Name:"页面"},{Code:"button",Name:"按钮"}],required:!0,align:"center"},{title:"目标",field:"Target",type:"checkbox",code:[{Code:"tab",Name:"Tab"},{Code:"_blank",Name:"Blank"},{Code:"toolbar",Name:"工具条"},{Code:"grid",Name:"表格内"},{Code:"batch",Name:"批量操作"}]},{title:"URL",field:"Url",type:"text",inputBlock:!0},{title:"状态",field:"Enabled",width:"80px",type:"checkbox",code:"Enabled",required:!0,align:"center"},{title:"顺序",field:"Sort",width:"50px",type:"text",required:!0,align:"center"},{onlyForm:!0,title:"备注",field:"Note",type:"textarea",lineBlock:!0}],refresh:function(){n.reload()},formOption:{titleInfo:function(n){return n.ParentName?"- "+n.ParentName:""}},gridOption:{url:"",page:!1,isTradition:!0,toolbar:{addSys:function(n){n.addRow({Id:"",AppId:"0",ParentId:"0",ParentName:"子系统",Enabled:1,Icon:"fa fa-file-o",Type:"菜单",Target:"tab"})},addMod:function(t){var i=n.selectedNode,u,f;if(!i){Layer.tips("请选择上级模块！");return}u=i.module;f=i.children||[];t.addRow({Id:"",AppId:r.code,ParentId:u.Id,ParentName:u.Name,Enabled:1,Icon:"fa fa-file-o",Type:"页面",Target:"tab",Sort:f.length+1})},addBtn:function(){var i=n.selectedNode;if(!i){Layer.tips("请选择模块！");return}e(i.module,function(i){Ajax.post(t.AddModules,{data:JSON.stringify(i)},function(){n.reload()})})},copy:function(i){i.selectRows(function(i){u("复制到",function(r){Ajax.post(t.CopyModules,{data:JSON.stringify(i.ids),mid:r.Id},function(){n.reload()})})})},move:function(i){i.selectRows(function(i){u("移动到",function(r){Ajax.post(t.MoveModules,{data:JSON.stringify(i.ids),mid:r.Id},function(){n.reload()})})})},enable:function(n){f(n,1)},disable:function(n){f(n,0)},sql:function(){o(function(n){var i=n.map(function(n){return n.id});Ajax.download(t.ExportModules,{data:JSON.stringify(i)})})}}}});this.render=function(n){i.render().appendTo(n)};this.mounted=function(){i.load()}}const sysBaseUrl=baseApiUrl+"/Dev",sysStaticUrl=baseUrl+"/plugins/wims";var DevPage={};$.extend(Page,{DevCode:{component:new DevCode}});$.extend(Page,{DevDocView:{component:new DevDocView}});$.extend(Page,{DevModule:{component:new DevModule}});