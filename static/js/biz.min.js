function BizFile(n,t){function f(){var t;BizForm.open({title:Language.AddAttachment,width:450,height:200,fields:[{field:"Category1",type:"hidden"},{field:"Category2",type:"hidden"},{field:"BizId",type:"hidden"},{title:Language.AttachmentType,field:"Type",type:"text",required:!0},{title:Language.Attachment,field:"Files",type:"file",multiple:!0,required:!0}],success:function(r){t=r.form;t.setData({Category1:Language.FormAttachment,Category2:n,BizId:i.Id})},buttons:[{text:Language.OK,handler:function(n){if(t.validate()){var f=t.getData();Ajax.upload("Files",u.UploadFiles,f,function(){n.close();r.reload({bizId:i.Id})})}}}]})}var u={QueryModels:baseUrl+"/System/GetFiles",DeleteModels:baseUrl+"/System/DeleteFiles",UploadFiles:baseUrl+"/System/UploadFiles"},i,r=new Grid("BizFile",{url:u.QueryModels,querys:[],page:!1,autoQuery:!1,columns:[{title:Language.AttachmentType,field:"Type"},{title:Language.AttachmentName,field:"Name",format:function(n){var i=Utils.getExtIcon(n.ExtName),t=$("<span>").append('<i class="'+i+'"><\/i> ');$('<span class="link">').html(n.Name).data("id",n.Id).appendTo(t).on("click",function(){var n=$(this).data("id");Ajax.download(BizFileDownloadUrl,{id:n})});return t}}],toolButtons:["add","remove"],toolbarTips:"<span>"+(t||"")+"<\/span>",toolbar:{add:function(){if(!i.Id){Layer.tips(Language.PleaseSaveBizForm);return}f()},remove:function(n){n.deleteRows(u.DeleteModels,function(){r.reload({bizId:i.Id})})}}});this.render=function(){return r.render()};this.load=function(n){i=n.head;r.setDetail(n.isDetail);r.reload({bizId:i.Id})}}function BizFlowLog(){var t={QueryModels:BizFlow.url.GetFlowLogs},n=new Grid("BizFile",{url:t.QueryModels,querys:[],page:!1,autoQuery:!1,showCheckBox:!1,columns:BizFlow.logColumns});this.render=function(){return n.render()};this.load=function(t){n.reload({bizId:t.head.Id})}}function NoticeList(n){$("#"+n).addClass("grid").html('<table id="gridNotice"><\/table>');var t={GetNewestNotices:baseUrl+"/System/GetNewestNotices"},i=new Grid("Notice",{url:t.GetNewestNotices,page:!1,fixed:!1,showCheckBox:!1,autoQuery:!1,columns:[{title:Language.Title,field:"Title",format:function(n){return $('<span class="link">').append(n.Title).data("data",n).click(function(){var n=$(this).data("data");Layer.open({title:n.Title,width:960,height:400,content:n.Content})})}},{title:Language.PublishTime,field:"PublishTime",width:"120px",placeholder:"yyyy-MM-dd HH:mm"}]});this.load=function(){i.reload()};this.more=function(){Layer.page({url:baseUrl+"/page?m=SysNotice&type=more"})}}function UserLink(n,t){function o(){u.html(Language.Loading+"......");$.get(r.GetUserLinks,{type:t},function(n){u.html("");for(var t=0;t<n.length;t++)s(n[t])})}function s(n){f.push(n.Address);var t=e.getDom(n);t.hover(function(){var t="data";$('<span class="close fa fa-close">').data(t,n).click(function(n){var i=$(this),u=i.parent(),f=i.data(t);Layer.confirm(Language.ConfirmDelete,function(){$.post(r.DeleteUserLink,{id:f.Id},function(){u.remove()})});n.stopPropagation()}).appendTo($(this))},function(){$(this).find(".close").remove()}).appendTo(u)}var r={GetUserLinks:baseUrl+"/System/GetUserLinks",DeleteUserLink:baseUrl+"/System/DeleteUserLink",AddUserLink:baseUrl+"/System/AddUserLink",AddShortcuts:baseUrl+"/System/AddShortcuts"},i=top.Admin.menuList,h={shortcut:{getDom:function(n){var u="data",f=i.filter(function(t){return t.id===n.Address}),t=f.length?f[0]:{},r=$("<li>").data(u,t).click(function(){var n=$(this).data(u);showTabPage(n)});return r.append('<span class="icon"><span class="'+t.icon+'"><\/span><\/span>'),r.append("<span>"+t.name+"<\/span>"),r},add:function(){var n;Layer.open({title:Language.Shortcut,icon:"fa fa-external-link",width:360,height:300,content:'<ul id="treeLink"><\/ul>',success:function(){for(var t=0;t<i.length;t++)f.indexOf(i[t].id)>-1&&(i[t].checked=!0);n=new Tree("treeLink",{data:i,check:!0})},buttons:[{text:Language.OK,handler:function(i){var e=n.getCheckedNodes(),s,h,f,u;if(e.length===0)Layer.tips(Language.PleaseSelectMenuItem);else{for(s=[],h=[],f=0;f<e.length;f++)u=e[f],u.children||h.indexOf(u.url)<0&&(s.push({Type:t,Name:u.name,Address:u.id}),h.push(u.id));$.post(r.AddShortcuts,{data:JSON.stringify(s)},function(){i.close();o()})}}}]})}},commlink:{getDom:function(n){var t="data",i=$("<li>").data(t,n).click(function(){var n=$(this).data(t);window.open(n.Address)});return i.append("<span>"+n.Name+"<\/span>"),i},add:function(){var i=this,n;Layer.open({title:Language.CommonLink,icon:"fa fa-external-link",width:400,height:220,content:'<div id ="formLink" class="form form-block">',success:function(){n=new Form("Link",{labelWidth:60,fields:[{title:Language.Name,field:"Name",type:"text",required:!0},{title:Language.Address,field:"Address",type:"text",required:!0,inputStyle:"width:280px"}],onSaving:function(n){n.Type=t;n.Address.indexOf("http://")<0&&(n.Address="http://"+n.Address)}})},buttons:[{text:Language.OK,handler:function(t){n.save(r.AddUserLink,function(n){t.close();s(n)})}}]})}}},u=$("#"+n).addClass(t),f=[],e=h[t];this.load=function(){o()};this.add=function(){e.add()}}const BizFileDeleteUrl=baseUrl+"/System/DeleteFile",BizFileDownloadUrl=baseUrl+"/System/DownloadFile";BizFile.download=function(n){Ajax.download(BizFileDownloadUrl,{id:n})};BizFile.delete=function(n){Layer.confirm(Language.ConfirmDeleteFile,function(){Ajax.post(BizFileDeleteUrl,{id:n})})};var BizFlow={url:{GetFlowTodos:baseUrl+"/System/GetFlowTodos",GetFlowLogs:baseUrl+"/System/GetFlowLogs",AssignFlow:baseUrl+"/System/AssignFlow",SubmitFlow:baseUrl+"/System/SubmitFlow",RevokeFlow:baseUrl+"/System/RevokeFlow",ReturnFlow:baseUrl+"/System/ReturnFlow",StopFlow:baseUrl+"/System/StopFlow"},logColumns:[{title:Language.ExecuteStep,field:"StepName",width:"100px"},{title:Language.ExecuteBy,field:"ExecuteBy",width:"100px"},{title:Language.ExecuteTime,field:"ExecuteTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:Language.ExecuteAction,field:"Result",width:"100px",format:function(n){return'<span class="badge">'+n.Result+"<\/span>"}},{title:Language.ExecuteContent,field:"Note"}],getStatusColor:function(n){return n?n.indexOf("暂存")>-1||n.indexOf("关闭")>-1?" gray":n.indexOf("撤回")>-1?" warning":n.indexOf("退回")>-1||n.indexOf("删除")>-1?" danger":n.indexOf("通过")>-1||n.indexOf("中")>-1?" success":n.indexOf("待")>-1||n.indexOf("已")>-1?" info":"":""},loadTodos:function(n){var t=this;$("#"+n).addClass("grid").html('<table id="gridFlowTask"><\/table>');new Grid("FlowTask",{url:t.url.GetFlowTodos,page:!1,fixed:!1,showCheckBox:!1,columns:[{title:Language.Type,field:"FlowName",width:"100px"},{title:Language.Status,field:"BizStatus",width:"80px",format:function(n){var i=t.getStatusColor(n.BizStatus);return'<span class="badge'+i+'">'+n.BizStatus+"<\/span>"}},{title:Language.Task,field:"BizName",format:function(n){var t=$('<span class="link">').data("url",n.BizUrl).html(n.BizName);if(n.BizUrl.indexOf("js:")>-1)t.on("click",function(){var n=$(this).data("url").substr(3);eval("("+n+")")});else t.on("click",function(){location=baseUrl+$(this).data("url")});return t}}]})},loadLogs:function(n,t){var i=typeof n=="string"?$("#"+n):n,r,u,f;i.addClass("flow-log").html("").append("<h2>"+Language.FlowRecord+"<\/h2>");r=this.url.GetFlowLogs+"?bizId="+t;u=[];Utils.checkMobile()?(u=[{title:Language.FlowStep,field:"StepName",format:function(n){var t=new Date(n.ExecuteTime).format("yyyy-MM-dd HH:mm:ss"),i='<div class="flow-name"><span class="flow-step">'+n.StepName+"<\/span>"+n.ExecuteBy+"（"+t+"）<\/div>";return i+('<div class="flow-note">'+n.Note+"<\/div>")}}],f=new Grid({url:r,columns:u}),f.render().appendTo(i)):(i.append('<table id="gridFlowLog"><\/table>'),new Grid("FlowLog",{page:!1,fixed:!1,showCheckBox:!1,url:r,columns:this.logColumns}))},assignData:{},assign:function(n,t){var i=this;this._openForm({title:Language.Assign,height:250,fields:[{title:Language.AssignTo,field:"UserName",type:"picker",pick:{action:"user"},required:!0},{title:Language.Note,field:"Note",type:"textarea"}],data:i.assignData,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.AssignFlow,{bizId:n,userName:r.data.UserName,note:r.data.Note},function(){t&&t();r.layer.close()})}})},submitData:{},submit:function(n,t){var i=this;this._openForm({title:Language.Submit,height:250,fields:[{title:Language.SubmitTo,field:"UserName",type:"picker",pick:{action:"user"},required:!0},{title:Language.Note,field:"Note",type:"textarea"}],data:i.submitData,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.SubmitFlow,{bizId:n,userName:r.data.UserName,note:r.data.Note},function(){t&&t();r.layer.close()})}})},revoke:function(n,t){var i=this;this._openForm({title:Language.Revoke,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.RevokeFlow,{bizId:n,reason:r.data.Reason},function(){t&&t();r.layer.close()})}})},"return":function(n,t,i){var r=this;this._openForm({title:Language.Return,callback:function(u){typeof n=="function"?n(u):Ajax.post(r.url.ReturnFlow,{bizId:n,bizStatus:t,reason:u.data.Reason},function(){i&&i();u.layer.close()})}})},stop:function(n,t){var i=this;this._openForm({title:Language.Stop,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.StopFlow,{bizId:n,reason:r.data.Reason},function(){t&&t();r.layer.close()})}})},_openForm:function(n){var t;n.fields||(n.fields=[{title:n.title+Language.Reason,field:"Reason",type:"textarea",required:!0}]);n.success=function(n){t=n.form};n.buttons=[{text:Language.OK,handler:function(i){if(t.validate()){var r=n.confirmText||Language.OK+n.title+"？";Layer.confirm(r,function(){var r=t.getData();n.callback&&n.callback({layer:i,data:r})})}}}];BizForm.open(n)}},BizForm={open:function(n){var i=$('<div class="form form-block">'),t=n.width;t||(t=Utils.checkMobile()?300:400);Layer.open({title:n.title,width:t,height:n.height||200,content:i,success:function(){var t=new Form(i,{fields:n.fields});n.data&&t.setData(n.data);n.success&&n.success({form:t})},buttons:n.buttons})},close:function(n,t){var i;this.open({title:n,fields:[{title:Language.Close+Language.Reason,field:"Reason",type:"textarea",required:!0}],success:function(n){i=n.form},buttons:[{text:Language.OK,handler:function(r){i.validate()&&Layer.confirm(Language.OK+n+"？",function(){r.close();var n=i.getData();t&&t(n.Reason)})}}]})}},BizHistory={url:{GetUserHistory:baseUrl+"/Home/GetUserHistory"},data:{},init:function(){var n=this;$.post(n.url.GetUserHistory,function(t){t&&(n.data=$.isPlainObject(t)?t:JSON.parse(t))})}},Log={url:{GetLogs:baseUrl+"/System/GetLogs"},open:function(n){var i=this,t=$("<div>");Layer.open({title:n.title||Language.OperateLog,width:n.width,height:n.height,content:t,success:function(){i.load(t,n.bizId)}})},load:function(n,t){var i=typeof n=="string"?$("#"+n):n,r,u;i.addClass("log").html("").append("<h2>"+Language.OperateLog+"<\/h2>");r=this.url.GetLogs+"?bizId="+t;u=[{title:Language.OperateType,field:"Type",width:"100px"},{title:Language.OperateBy,field:"CreateBy",width:"100px"},{title:Language.OperateTime,field:"CreateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:Language.OperateContent,field:"Content"}];i.append('<table id="gridSysLog"><\/table>');new Grid("SysLog",{page:!1,fixed:!1,showCheckBox:!1,url:r,columns:u})}},BizPreview={tiff:function(n,t){typeof Tiff=="undefined"&&Utils.addJs(baseUrl+"/static/libs/tiff.min.js");n.html(Language.Loading+"......");var i=new XMLHttpRequest;i.responseType="arraybuffer";i.open("GET",t);i.onload=function(){var t=new Tiff({buffer:i.response}),r=t.toCanvas();n.html("").append(r)};i.send()}},KBMap={isLoad:!1,url:"http://api.map.baidu.com/api?v=2.0&ak=stivIs1QN5tRtrmycPDBKREhfGDigZKN",id:"",option:{},style:{dark:{styleJson:[{featureType:"water",elementType:"all",stylers:{color:"#021019"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#08304b"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.icon",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#2da0c6",visibility:"on"}}]},light:{styleJson:[{featureType:"land",elementType:"geometry",stylers:{color:"#e7f7fc"}},{featureType:"water",elementType:"all",stylers:{color:"#96b5d6"}},{featureType:"green",elementType:"all",stylers:{color:"#b0d3dd"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#a6cfcf"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#7dabb3"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#e7f7fc"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#b0d5d4"}},{featureType:"local",elementType:"labels.text.fill",stylers:{color:"#7a959a"}},{featureType:"local",elementType:"labels.text.stroke",stylers:{color:"#d6e4e5"}},{featureType:"arterial",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.stroke",stylers:{color:"#e9eeed"}}]}},init:function(n,t){this.id=n;this.option=t;this.isLoad||(window.onload=function(){var n=document.createElement("script");n.src=KBMap.url+"&callback=KBMap.initMap";document.body.appendChild(n)},this.isLoad=!0)},setMap:function(n,t){this._initMap(n,t)},initMap:function(){this.id&&this._initMap(this.id,this.option)},_initMap:function(n,t){var i=new BMap.Map(n);i.setMapStyle(this.style[t.style||"light"]);t.callback&&t.callback(i)}};KBMap.loadBMapScript=function(){window.BMap_loadScriptTime=(new Date).getTime();document.write('<script src="'+KBMap.url+'&services=&t=20200914160603"><\/script>')};KBMap.createSelectMapButton=function(n){function i(n,i){return $("<button>").html(Language.Select).click(function(){var r;Layer.open({title:Language.SelectCoordinate,width:650,height:350,content:function(n){var t=$("<div>").appendTo(n);$('<input type="text" id="mapKey" style="width:200px;margin-right:2px;" />').appendTo(t);$("<button>"+Language.Query+"<\/button>").appendTo(t).on("click",function(){var n=new BMap.LocalSearch(r,{renderOptions:{map:r}}),t=document.getElementById("mapKey").value;n.search(t)});$('<div id="'+i+'" class="fit" style="top:40px;z-index:99999;">').appendTo(n)},success:function(){var u,f,e,o;r=new BMap.Map(i,{enableMapClick:!1});r.enableScrollWheelZoom(!0);r.enableContinuousZoom();r.setDefaultCursor("default");r.setDraggingCursor("default");r.addEventListener("click",function(i){r.clearOverlays();n.Longitude.setValue(i.point.lng);n.Latitude.setValue(i.point.lat);t(r,i.point.lng,i.point.lat)});u=n.Longitude.getValue();f=n.Latitude.getValue();u&&f?t(r,u,f):n.Area?(e=n.Area.getValue(),r.centerAndZoom(e,15)):n.City&&(o=n.City.getValue(),r.centerAndZoom(o,15))}})})}function t(n,t,i){var r=new BMap.Point(t,i),u;n.centerAndZoom(r,15);u=new BMap.Marker(r);n.addOverlay(u)}KBMap.loadBMapScript();i(n.form,"mapContainer").appendTo(n.parent)};KBMap.setBoundary=function(n,t){var i=new BMap.Boundary;i.get(t,function(t){var f=t.boundaries.length,i,r,u;if(f===0){alert(Language.NoCurrentAreaTips);return}for(i=[],r=0;r<f;r++)u=new BMap.Polygon(t.boundaries[r],{strokeWeight:2,strokeColor:"#014F99",fillColor:"#DDE4F0"}),n.addOverlay(u),i=i.concat(u.getPath());n.setViewport(i)})};KBMap.addMapMarker=function(n,t,i){var u=new BMap.Point(t.Longitude,t.Latitude),r=new BMap.Marker(u);n.addOverlay(r);r.setTitle(t.Name);r.addEventListener("click",function(){i&&i(t)})};