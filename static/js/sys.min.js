function SysDictionary(){var n=baseUrl+"/System/",r={QueryModels:n+"QueryDictionarys",DeleteModels:n+"DeleteDictionarys",SaveModel:n+"SaveDictionary",GetDicCategories:n+"GetDicCategories"},t,f=new ListBox("listCategory",{url:r.GetDicCategories,autoLoad:!1,onClick:function(n){t=n;i.loadGrid({Category:n.Code})}}),u=[{field:"Id",type:"hidden"},{field:"Category",type:"hidden"},{field:"CategoryName",type:"hidden"},{title:Language.Code,field:"Code",width:"150px",query:!0,type:"text",required:!0},{title:Language.Name,field:"Name",width:"150px",query:!0,type:"text"},{title:Language.Status,field:"Enabled",width:"80px",align:"center",type:"checkbox",code:"Enabled",required:!0},{title:Language.Sort,field:"Sort",width:"50px",align:"center",type:"text",required:!0},{title:Language.Note,field:"Note",type:"textarea"}],i;curUser.AppId==="DEV"&&u.splice(3,0,{title:Language.System,field:"AppId",width:"80px",query:!0,type:"select",code:"ProductData",required:!0,sort:!0});i=new View("SysDictionary",{url:r,left:f,columns:u,formOption:{style:"form-block",titleInfo:function(n){return"- "+n.Category+"|"+n.CategoryName}},gridOption:{autoQuery:!1,showModifyBy:!0,showCreateBy:!0,sortField:"Sort",sortOrder:"asc",where:{Category:""},toolbar:{add:function(n){if(!t){Layer.tips(Language.PleaseDicCategory);return}n.addRow({Id:"",Enabled:1,Category:t.Code,CategoryName:t.Name})}}}});this.render=function(n){i.render().appendTo(n)};this.mounted=function(){i.load()}}function SysError(){function r(n){Layer.open({title:Language.Error+Language.Detail,width:1e3,height:400,content:"<pre>"+n.StackTrace+"<\/pre>"})}function u(t){Layer.confirm(Language.ConfirmDelete,function(){Ajax.post(i.DeleteError,{id:t},function(){n.load()})})}var t=baseUrl+"/System/",i={QueryModels:t+"QueryErrors",DeleteError:t+"DeleteError"},n=new View("SysError",{url:i,columns:[{title:Language.Operate,field:"Id",width:"100px",format:function(n){var t=$("<span>");$('<span class="link" style="margin-right:5px;">').data("data",n).html(Language.Detail).appendTo(t).on("click",function(){r($(this).data("data"))});$('<span class="link">').data("id",n.Id).html(Language.Remove).appendTo(t).on("click",function(){u($(this).data("id"))});return t}},{title:Language.System,field:"System",width:"80px",query:!0},{title:Language.OperateBy,field:"User",width:"80px",query:!0},{title:Language.OperateTime,field:"CreateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:Language.ErrorMessage,field:"Message",width:"150px"},{title:"IP",field:"IP",width:"150px",format:function(n){return n.IP+" - "+n.IPName}},{title:"Url",field:"Url"}],gridOption:{page:!1}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysFile(){function u(){var n;Layer.open({title:Language.AddDocument,width:500,height:300,content:'<div id="formAddFile" class="form form-block">',success:function(){n=new Form("AddFile",{fields:[{title:Language.Category1,field:"Category1",type:"text",required:!0},{title:Language.Category2,field:"Category2",type:"text"},{title:Language.Attachment,field:"Files",type:"file",multiple:!0}]})},buttons:[{text:Language.OK,handler:function(r){if(n.validate()){var u=n.getData();Ajax.upload("Files",t.UploadFiles,u,function(){r.close();i.load()})}}}]})}var n=baseUrl+"/System/",t={QueryModels:n+"QueryFiles",DeleteModels:n+"DeleteFiles",SaveModel:n+"SaveFile",GetFileCategories:n+"GetFileCategories",UploadFiles:n+"UploadFiles",DownloadFile:n+"DownloadFile",DownloadSysFile:n+"DownloadSysFile"},r=new Tree("treeFile",{url:t.GetFileCategories,autoLoad:!1,onClick:function(n){i.loadGrid({Category1:n.Category1,Category2:n.Category2})}}),i=new View("SysFile",{url:t,left:r,columns:[{field:"Id",type:"hidden"},{title:Language.Category1,field:"Category1",width:"100px",type:"text",required:!0,onlyForm:!0},{title:Language.Category2,field:"Category2",width:"100px",type:"text",onlyForm:!0},{title:Language.FileName,field:"Name",width:"100px",query:!0,format:function(n){var r=Utils.getExtIcon(n.ExtName),i=$("<span>").append('<i class="'+r+'"><\/i> ');$('<span class="link">').html(n.Name).data("id",n).appendTo(i).on("click",function(){var n=$(this).data("id");n.Id===""?Ajax.download(t.DownloadSysFile,{bizId:n.BizId}):Ajax.download(t.DownloadFile,{id:n.Id})});return i},type:"text",required:!0,inputBlock:!0},{title:Language.FileType,field:"Type",width:"100px",type:"text"},{title:Language.FileSize,field:"Size",width:"100px",align:"right",type:"text",readonly:!0},{title:Language.FileSourceName,field:"SourceName",width:"100px",type:"text",readonly:!0,inputBlock:!0},{title:Language.ExtName,field:"ExtName",width:"100px",query:!0,type:"text",readonly:!0},{title:Language.Note,field:"Note",type:"textarea",lineBlock:!0},{title:Language.UploadBy,field:"CreateBy",width:"100px"},{title:Language.UploadTime,field:"CreateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss",align:"center"}],gridOption:{toolbar:{add:function(){u()},edit:function(n){n.editRow(function(n){return n.row.Id===""?(Layer.tips(Language.SysFileNotEdit),!1):!0})},remove:function(n){var i=!1;if(n.selectRows(function(n){for(var t=0;t<n.rows.length;t++)if(n.rows[t].Id===""){i=!0;break}}),i)return Layer.tips(Language.SysFileNotDelete),!1;n.deleteRows(t.DeleteModels,function(n){n.grid.reload()})}}}});this.render=function(n){i.render().appendTo(n)};this.mounted=function(){i.load()}}function SysFlow(n){var i={GetModel:baseUrl+"/System/GetFlowStep",SaveModel:baseUrl+"/System/SaveFlowStep"},r,t;n=n||{Code:"SysFlow"};r=new FlowChart(n.Code,{items:n.steps,click:function(r){$.get(i.GetModel,{flowCode:n.Code,stepCode:r.step.id},function(i){i||(i={Id:"",FlowCode:n.Code,FlowName:n.Name});i.StepCode=r.step.id;i.StepName=r.step.name;i.StepType=r.step.flag;i.X=r.step.x;i.Y=r.step.y;i.IsRound=r.step.round?1:0;t.setData(i)})}});t=new Form(n.Code,{style:"form-block",labelWidth:60,fields:[{field:"Id",type:"hidden"},{field:"FlowCode",type:"hidden"},{field:"FlowName",type:"hidden"},{field:"StepCode",type:"hidden"},{field:"StepType",type:"hidden"},{field:"X",type:"hidden"},{field:"Y",type:"hidden"},{field:"IsRound",type:"hidden"},{field:"Arrows",type:"hidden"},{title:Language.Name,field:"StepName",type:"text",readonly:!0},{title:Language.OperateBy,field:"OperateBy",type:"picker",pick:{action:"user"}},{title:Language.Description,field:"Note",type:"textarea"}],toolbar:[{text:Language.OK,handler:function(){t.save(i.SaveModel)}}]});this.render=function(n){var i=$('<div class="fit-col" style="overflow:hidden;">').appendTo(n);r.render(i);t.render().appendTo(i);t.elem.addClass("form-flow").css({width:"300px",height:"300px"})};this.mounted=function(){}}function SysJob(){var i={QueryModels:baseUrl+"/System/QueryJobSettings",DeleteModels:baseUrl+"/System/DeleteJobSettings",SaveModel:baseUrl+"/System/SaveJobSetting"},n,t=new View("JobSetting",{url:i,columns:[{field:"Id",type:"hidden"},{title:Language.CompNo,field:"CompNo",width:"100px",query:!0,format:function(n){var t=n.CompNo;return n.CompName&&(t+="-"+n.CompName),t},type:"text",required:!0},{title:Language.System,field:"AppId",width:"100px",query:!0,format:function(n){var t=n.AppId;return n.AppName&&(t+="-"+n.AppName),t},type:"select",required:!0,code:"ProductData"},{title:Language.Name,field:"Name",width:"100px",query:!0,type:"text",required:!0},{title:"Job"+Language.Type,field:"TypeName",width:"100px",type:"text",inputStyle:"width:50%",lineBlock:!0,required:!0,inputHtml:'<div id="rblTypeName" style="display:inline-block;margin-left:5px;"><\/div>'},{title:Language.ExecuteTime,field:"RunTime",width:"100px",type:"text",tips:Language.Sample+"：HH:mm:ss=07:00:00"},{title:Language.ExecuteInterval,field:"Interval",width:"100px",type:"text",tips:Language.ExecuteIntervalTips},{title:Language.ExecuteStatus,field:"Status",width:"100px",type:"select",format:function(n){var t=" gray";return n.Status===Language.Executing?t=" info":n.Status===Language.ExecutePass?t=" success":n.Status===Language.ExecuteFail&&(t=" danger"),'<span class="badge'+t+'">'+n.Status+"<\/span>"},query:!0,readonly:!0,code:[Language.NoExecute,Language.Executing,Language.ExecutePass,Language.ExecuteFail]},{title:Language.LastTime,field:"LastTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss",align:"center"},{label:Language.Option,title:Language.Enable,field:"Enabled",width:"100px",align:"center",type:"checkbox",required:!0,code:"YesNo"},{title:Language.ErrorMessage,field:"Exception",format:function(n){return n.Exception?$('<span class="link">'+Language.Detail+"<\/span>").data("note",n.Exception).on("click",function(){var n=$(this).data("note");Layer.open({title:Language.Error+Language.Detail,content:"<pre>"+n+"<\/pre>"})}):""}},{onlyForm:!0,title:Language.ExecuteParams,field:"Params",type:"html",lineBlock:!0,inputHtml:'<table id="gridParam" class="grid"><\/table>'}],formOption:{data:{Id:"",Status:Language.NoExecute,Enabled:1},setData:function(t){var r,i,u;if(new Input($("#rblTypeName"),{type:"radio",field:"JobType",code:["HttpJob","TaskJob"],onClick:function(n){t.form.TypeName.setValue(n)}}),n=new Grid("Param",{edit:!0,columns:[{action:"add",icon:"fa fa-plus",align:"center",width:"80px",actionFormat:function(){return'<span class="link" action="remove">'+Language.Delete+"<\/span>"}},{title:Language.ParameterName,field:"Name",type:"text",width:"150px"},{title:Language.ParameterValue,field:"Value",type:"text"}]}),r=[],i=t.data.Params,i)for(u in i)r.push({Name:u,Value:i[u]});n.setData(r)},onSaving:function(t){var r=n.getData(),i,u;if(r.length)for(t.Params={},i=0;i<r.length;i++)u=r[i],t.Params[u.Name]=u.Value}}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysLog(){var t={QueryModels:baseUrl+"/System/QueryLogs"},n=new View("SysLog",{url:t,columns:[{title:Language.OperateBy,field:"CreateBy",width:"80px",query:!0},{title:Language.OperateTime,field:"CreateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:Language.LogType,field:"Type",width:"100px"},{title:Language.LogTarget,field:"Target",width:"100px"},{title:Language.LogContent,field:"Content",query:!0}],gridOption:{sortField:"CreateTime",sortOrder:"desc"}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysNoRule(){function u(){t.load();t.setGridData([])}function o(){var t;Layer.open({title:Language.NoRule,width:450,height:330,content:'<div id ="formNoRule" class="form form-block">',success:function(){t=new Form("NoRule",{fields:[{field:"Id",type:"hidden"},{title:Language.System,field:"AppId",type:"select",code:"ProductData",required:!0},{title:Language.Number,field:"Code",type:"text",required:!0},{title:Language.Name,field:"Name",type:"text",required:!0},{title:Language.Description,field:"Description",type:"textarea"}]})},buttons:[{text:Language.OK,handler:function(i){t.save(n.SaveModel,function(){u();i.close()})}}]})}function s(){if(!i){Layer.tips(Language.PleaseSelectRuleName);return}var r=t.getGridData();i.RuleData=JSON.stringify(r);Ajax.post(n.SaveModel,{data:JSON.stringify(i)})}function h(){Layer.confirm(Language.ConfirmDelete,function(){Ajax.post(n.DeleteModels,{data:JSON.stringify([f.selected.Id])},function(){u()})})}var r=baseUrl+"/System/",n={GetNoRules:r+"GetNoRules",DeleteModels:r+"DeleteNoRules",SaveModel:r+"SaveNoRule"},i,f=new ListBox("listCategory",{url:n.GetNoRules,autoLoad:!1,onClick:function(n){i=n;var r=[];n.RuleData&&(r=JSON.parse(n.RuleData));t.setGridData(r)}}),e='<div style="color:#00f;">'+Language.NoRuleTips+"<\/span>",t=new View("SysNoRule",{url:n,left:f,columns:[{action:"add",icon:"fa fa-plus",align:"center",width:"80px",actionFormat:function(){return'<span class="link red fa fa-trash-o" action="remove" title="'+Language.Delete+'"><\/span> <span class="link fa fa-arrow-up" action="up" title="'+Language.MoveUp+'"><\/span> <span class="link fa fa-arrow-down" action="down" title="'+Language.MoveDown+'"><\/span>'}},{title:Language.Type,field:"Type",type:"select",width:"100px",code:[Language.FixedValue,Language.DateValue,Language.SeqNo]},{title:Language.Value,field:"Value",type:"text"}],gridOption:{edit:!0,fixed:!0,toolbar:{add:function(){o()},save:function(){s()},remove:function(){h()}},footer:e}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){u()}}function SysNotice(){var n=baseUrl+"/System/",r=Utils.getUrlParam("type"),i={QueryModels:n+"QueryNotices",DeleteModels:n+"DeleteNotices",SaveModel:n+"SaveNotice",PublishNotice:n+"PublishNotice"},t=new View("SysNotice",{url:i,columns:[{field:"Id",type:"hidden"},{title:Language.Title,field:"Title",query:!0,format:function(n){return $('<span class="link">').append(n.Title).data("data",n).click(function(){var n=$(this).data("data");Layer.open({title:n.Title,width:960,height:500,content:n.Content})})},type:"text",required:!0,lineBlock:!0,inputStyle:"width:50%"},{onlyForm:!0,title:Language.Content,field:"Content",type:"editor",required:!0,lineBlock:!0},{title:Language.Status,field:"Status"},{title:Language.PublishBy,field:"PublishBy",type:"text"},{title:Language.PublishTime,field:"PublishTime",placeholder:"yyyy-MM-dd HH:mm",type:"date"}],formToolbar:[{text:Language.Publish,icon:"fa fa-send-o",handler:function(n){n.form.save(i.PublishNotice,function(){t.loadGrid()})}}],gridOption:{showModifyBy:!0,showCreateBy:!0,where:{type:r}}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysOrganization(){var i=baseUrl+"/System/",r={DeleteModels:i+"DeleteOrganizations",SaveModel:i+"SaveOrganization",GetOrganizations:i+"GetOrganizations"},n=new Tree("treeOrganization",{url:r.GetOrganizations,onClick:function(n){if(n.children){var i=n.children.map(function(n){return n.data});t.setGridData(i)}}}),t=new View("SysOrganization",{url:r,left:n,columns:[{field:"Id",type:"hidden"},{field:"ParentId",type:"hidden"},{title:Language.Code,field:"Code",width:"100px",type:"text",required:!0},{title:Language.Name,field:"Name",width:"250px",type:"text",required:!0},{title:Language.Note,field:"Note",type:"textarea"}],refresh:function(){n.reload();t.setGridData([])},formOption:{style:"form-block",width:600,height:300,titleInfo:function(t){var i=n.getNodeData(function(n){return n.id===t.ParentId});return i?"- "+i.Code+"|"+i.Name:""},setData:function(n){n.form.Code.setReadonly(n.data.Id!=="")}},gridOption:{page:!1,showModifyBy:!0,showCreateBy:!0,toolbar:{add:function(t){var i=n.selectedNode;if(!i){Layer.tips(Language.PleaseSelectParentOrg);return}t.addRow({Id:"",ParentId:i.id})}}}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysRole(){function r(n,i){var r;Layer.open({title:Language.PermissionSetting+" - "+n.Name,width:850,height:450,content:'<ul id="treeRoleRight"><\/ul>',success:function(){r=new Tree("treeRoleRight",{url:t.GetRoleModules+"?roleId="+n.Id,check:!0,expandAll:!0,onLoad:function(){var n=$(".tree-button").parent().parent().addClass("tree-button-ul");n.parent().addClass("tree-page-li")}})},buttons:[{text:Language.OK,handler:function(n){n.close();var t=r.getCheckedNodes();i&&i(t)}}]})}var n=baseUrl+"/System/",t={QueryModels:n+"QueryRoles",DeleteModels:n+"DeleteRoles",SaveModel:n+"SaveRole",GetRoleModules:n+"GetRoleModules",SaveRoleModules:n+"SaveRoleModules"},i=new View("SysRole",{url:t,columns:[{field:"Id",type:"hidden"},{title:Language.Name,field:"Name",width:"150px",query:!0,type:"text",required:!0},{title:Language.Status,field:"Enabled",width:"100px",type:"checkbox",code:"Enabled",required:!0},{title:Language.Note,field:"Note",type:"textarea"}],formOption:{style:"form-block",width:600,height:300,data:{Id:"",Enabled:1}},gridOption:{showModifyBy:!0,showCreateBy:!0,toolbar:{right:function(n){n.selectRow(function(n){r(n.row,function(i){var r=i.map(function(n){return n.id});Ajax.post(t.SaveRoleModules,{roleId:n.row.Id,data:JSON.stringify(r)})})})}}}});this.render=function(n){i.render().appendTo(n)};this.mounted=function(){i.load()}}function SysServer(){function i(n){Layer.open({title:Language.ThreadInfo+" - "+n.Type,width:550,height:300,content:'<div class="fit"><table id="gridThreadInfo" class="grid"><\/table><\/div>',success:function(){var t=new Grid("ThreadInfo",{columns:[{title:"ID",field:"Id"},{title:Language.Name,field:"Name"},{title:Language.Status,field:"Status",format:function(n){var t=" gray";return n.Status.indexOf("正常")>-1||n.Status.indexOf("已")>-1?t=" success":n.Status.indexOf("异常")>-1&&(t=" danger"),'<span class="badge'+t+'">'+n.Status+"<\/span>"}},{title:Language.Description,field:"Description"},{title:Language.ErrorMessage,field:"ErrorMessage"}]});t.setData(n.Threads)}})}var t={QueryModels:baseUrl+"/System/QueryServers"},n=new View("SysServer",{url:t,columns:[{title:Language.Customer,field:"CompName",query:!0},{title:Language.System,field:"AppId",query:!0,code:"ProductData"},{title:Language.Service,field:"Type"},{title:Language.Status,field:"Status",format:function(n){var t=" gray";return n.Status===Language.Normal&&(t=" success"),'<span class="badge'+t+'">'+n.Status+"<\/span>"},code:[Language.BreakOff,Language.Normal]},{title:Language.ThreadCount,field:"ThreadCount",format:function(n){return $('<span class="link">').html(n.ThreadCount).data("item",n).on("click",function(){var n=$(this).data("item");i(n)})}},{title:Language.UpdateTime,field:"UpdateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:Language.StartTime,field:"CreateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:"IP",field:"IP",width:"150px",format:function(n){return n.IP+" - "+n.IPName}},{title:"MAC"+Language.Address,field:"MacAddress"}],gridOption:{page:!1}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysSetting(){var t={GetModel:baseUrl+"/System/GetSetting",SaveModel:baseUrl+"/System/SaveSetting"},n=new Form("SysSetting",{icon:"fa fa-cog",title:Language.SystemSetting,info:!0,fields:[{title:Language.CompNo,field:"CompNo",type:"text",readonly:!0},{title:Language.Product+"ID",field:"ProductId",type:"text",readonly:!0},{title:Language.CompName,field:"CompName",type:"text",required:!0,inputBlock:!0},{title:Language.ProductSerialNo,field:"SerialNo",type:"text",readonly:!0,inputBlock:!0},{title:Language.SystemName,field:"AppName",type:"text",required:!0,inputBlock:!0},{title:Language.ProductValidDate,field:"ValidDate",type:"text",readonly:!0,tips:"天"},{title:Language.UserDefaultPwd,field:"UserDefaultPwd",type:"text",required:!0}],toolbar:[{text:Language.Save,icon:"fa fa-check",handler:function(n){n.form.save(t.SaveModel)}}]});this.render=function(t){n.render().css({display:"block"}).appendTo(t)};this.mounted=function(){n.ValidDate.setTips("&nbsp;");$.get(t.GetModel,function(t){var i;if(n.setData(t),i=t.ValidDate,i!=="永久"){var r=Date.parse(i),u=new Date,f=parseInt((r-u)/864e5)+1,e=Utils.format(Language.ProductValidDateTip,f);n.ValidDate.setTips(e,{color:"#e00211"})}})}}function SysSite(){var t={QueryModels:baseUrl+"/System/QuerySites",DeleteModels:baseUrl+"/System/DeleteSites",SaveModel:baseUrl+"/System/SaveSite"},n=new View("SysSite",{url:t,columns:[{field:"Id",type:"hidden"},{title:"Host",field:"Host",type:"text",required:!0,format:function(n){return'<a href="http://'+n.Host+'" target="_blank">'+n.Host+"<\/i>"}},{title:"AppId",field:"AppId",type:"text",required:!0},{title:"图标",field:"AppIcon",type:"text",required:!0,format:function(n){var t="#"+Math.random().toString(16).substr(2,6);return'<i class="'+n.AppIcon+'" style="color:'+t+'"><\/i>'}},{title:"App名称",field:"AppName",type:"text",inputStyle:"width:300px",required:!0},{title:"企业编码",field:"CompNo",type:"text",required:!0},{title:"企业名称",field:"CompName",type:"text",inputStyle:"width:300px",required:!0},{title:"技术支持",field:"SupportName",type:"text",inputStyle:"width:300px"},{title:"技术支持URL",field:"SupportUrl",type:"text",inputStyle:"width:300px"},{title:"登录背景图",field:"LoginImage",type:"text",inputStyle:"width:300px"},{label:"选项",title:"状态",field:"Enabled",type:"checkbox",required:!0,align:"center",code:"Enabled"},{label:"选项",title:"顶部菜单",field:"TopMenu",type:"checkbox",required:!0,align:"center",code:"YesNo"},{title:"备注",field:"Note",type:"textarea",lineBlock:!0}],formOption:{data:{Id:"",Enabled:1}},gridOption:{autoQuery:!1,page:!1,toolButtons:["add",{name:"复制",icon:"fa fa-copy",handler:function(n){n.selectRow(function(n){var t=$.extend({},n.row,{Id:""});n.form.show(t)})}},"edit","remove"]}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysTask(){var t={QueryModels:baseUrl+"/System/QueryTasks"},n=new View("SysTask",{url:t,columns:[{title:Language.Type,field:"Type",width:"100px",query:!0},{title:Language.Name,field:"Name",width:"200px",query:!0},{title:Language.ExecuteTarget,field:"Target",width:"200px"},{title:Language.ExecuteStatus,field:"Status",width:"100px",format:function(n){var t=" gray";return n.Status===Language.Executing?t=" info":n.Status===Language.ExecutePass?t=" success":n.Status===Language.ExecuteFail&&(t=" danger"),'<span class="badge'+t+'">'+n.Status+"<\/span>"},query:!0,code:[Language.PendingExecute,Language.Executing,Language.ExecutePass,Language.ExecuteFail]},{title:Language.BeginTime,field:"BeginTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:Language.EndTime,field:"EndTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"},{title:Language.Note,field:"Note",format:function(n){return n.Note?$('<span class="link">'+Language.Detail+"<\/span>").data("note",n.Note).on("click",function(){var n=$(this).data("note");Layer.open({title:Language.Error+Language.Detail,content:"<pre>"+n+"<\/pre>"})}):""}}],gridOption:{sortField:"CreateTime",sortOrder:"desc"}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysUser(n){function e(n,t){var u=n.Name+"("+n.UserName+")",r;Layer.open({title:Language.RoleSetting+' - <span class="bold">'+u+"<\/span>",width:350,height:200,content:'<div id="chkUserRole"><\/div>',success:function(){$.get(i.GetUserRoles,{userId:n.Id},function(n){r=new Input($("#chkUserRole"),{field:"UserRole",type:"checkbox",code:n.roles,value:n.value})})},buttons:[{text:Language.OK,handler:function(n){var i=r.getData();t&&t(i);n.close()}}]})}function f(n,t){var r=t===1?Language.Enable:Language.Disable;n.selectRows(function(n){var u=Utils.format(Language.ConfirmOperateUser,r);Layer.confirm(u,function(){Ajax.post(i.EnableUsers,{data:JSON.stringify(n.ids),enable:t},function(){n.grid.reload()})})})}var t=baseUrl+"/System/",i={QueryModels:t+"QueryUsers",DeleteModels:t+"DeleteUsers",ImportModels:t+"ImportUsers",SaveModel:t+"SaveUser",GetOrganizations:t+"GetOrganizations",SetUserPwds:t+"SetUserPwds",EnableUsers:t+"EnableUsers",GetUserRoles:t+"GetUserRoles",SaveUserRoles:t+"SaveUserRoles"},r=n?new Tree("treeUser",{url:i.GetOrganizations,autoLoad:!1,onClick:function(n){u.loadGrid({OrgNo:n.code})}}):null,u=new View("SysUser",{url:i,left:r,columns:[{field:"Id",type:"hidden"},{field:"OrgNo",type:"hidden"},{title:Language.UserName,field:"UserName",width:"100px",query:!0,sort:!0,type:"text",required:!0},{title:Language.UserRealName,field:"Name",width:"100px",query:!0,sort:!0,type:"text",required:!0},{title:Language.EnglishName,field:"EnglishName",width:"100px",type:"text"},{title:Language.Role,field:"Role",width:"100px"},{title:Language.Gender,field:"Gender",width:"60px",align:"center",sort:!0,format:function(n){return n.Gender===Language.Male?Language.Male:'<span style="color: #F581B1;">'+Language.Female+"<\/span>"},required:!0,type:"radio",code:[Language.Male,Language.Female]},{title:Language.Phone,field:"Phone",width:"120px",type:"text"},{title:Language.Mobile,field:"Mobile",width:"120px",type:"text"},{title:Language.Email,field:"Email",width:"150px",type:"text"},{title:Language.Status,field:"Enabled",width:"60px",type:"checkbox",code:"Enabled",required:!0},{title:Language.FirstLoginTime,field:"FirstLoginTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss",align:"center"},{title:Language.FirstLoginIP,field:"FirstLoginIP",width:"100px",align:"center"},{title:Language.LastLoginTime,field:"LastLoginTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss",align:"center"},{title:Language.LastLoginIP,field:"LastLoginIP",width:"100px",align:"center"},{title:Language.Note,field:"Note",type:"textarea",lineBlock:!0}],formOption:{data:{Id:"",Enabled:1},titleInfo:function(t){var i=n?r.getNodeData(function(n){return n.id===t.OrgNo}):null;return i?'- <span class="bold">'+i.Code+"|"+i.Name+"<\/span>":""},setData:function(n){n.form.UserName.setReadonly(n.data.Id!=="")}},gridOption:{autoQuery:!1,width:"1800px",toolbar:{add:function(t){var u=curUser.CompNo,i;if(n){if(i=r.selectedNode,!i){Layer.tips(Language.PleaseSelectOrg);return}u=i.data.Code}t.addRow({Id:"",Enabled:1,OrgNo:u})},role:function(n){n.selectRow(function(n){e(n.row,function(t){Ajax.post(i.SaveUserRoles,{userId:n.row.Id,data:JSON.stringify(t)},function(){n.grid.reload()})})})},setPwd:function(n){n.selectRows(function(n){Layer.confirm(Language.ConfirmResetPassword,function(){Ajax.post(i.SetUserPwds,{data:JSON.stringify(n.ids)})})})},enable:function(n){f(n,1)},disable:function(n){f(n,0)}}}});this.render=function(n){u.render().appendTo(n)};this.mounted=function(){u.load({OrgNo:curUser.CompNo})}}function SysUserInfo(){var n=new Tabs({fit:!0,items:[{name:Language.BaseInfo,component:new SysUserBaseInfo},{name:Language.UpdatePassword,component:new SysUserPassword},{name:Language.MyMessage,component:new SysUserMessage}]});this.render=function(t){var r=$('<div class="fit">').appendTo(t),f=$('<div class="fit-col-3">').appendTo(r),i=$('<div style="padding:10px;">').appendTo(f),u;$('<div class="center" style="padding:20px;">').append('<img id="userAvatar" class="circle" src="'+baseUrl+'/static/img/face1.png" />').appendTo(i);$('<div class="info-item">').append('<i class="fa fa-user">').append('<span id="userName">').appendTo(i);$('<div class="info-item">').append('<i class="fa fa-mobile" style="font-size:16px;">').append('<span id="userMobile">').appendTo(i);$('<div class="info-item">').append('<i class="fa fa-envelope-o" style="font-size:11px;">').append('<span id="userEmail">').appendTo(i);$('<div id="userNote" class="info-item">').appendTo(i);u=$('<div class="fit-col-7">').appendTo(r);n.render().appendTo(u)};this.mounted=function(){}}function SysUserBaseInfo(){var n={GetUserInfo:baseUrl+"/Home/GetUserInfo",SaveUserInfo:baseUrl+"/Home/SaveUserInfo"},t=new Form("UserInfo",{url:n.GetUserInfo,fields:[{field:"Id",type:"hidden"},{field:"AvatarUrl",type:"hidden"},{title:Language.UserName,field:"UserName",type:"text",readonly:!0},{title:Language.UserRealName,field:"Name",type:"text",required:!0},{title:Language.EnglishName,field:"EnglishName",type:"text"},{title:Language.Gender,field:"Gender",type:"radio",code:[Language.Male,Language.Female]},{title:Language.Phone,field:"Phone",type:"text"},{title:Language.Mobile,field:"Mobile",type:"text"},{title:Language.Email,field:"Email",type:"text"},{title:Language.Note,field:"Note",type:"textarea",lineBlock:!0}],setData:function(n){$("#userAvatar").attr("src",baseUrl+n.data.AvatarUrl);top.Admin.setUserAvatar(n.data.AvatarUrl);$("#userName").html(n.data.Name+"("+n.data.UserName+")");$("#userMobile").html(n.data.Mobile);$("#userEmail").html(n.data.Email);$("#userNote").html(n.data.Note)},onSaving:function(n){var t=n.Gender===Language.Female?"2":"1";n.AvatarUrl="/static/img/face"+t+".png"},toolbar:[{text:Language.ConfirmUpdate,icon:"fa fa-check",handler:function(t){t.form.save(n.SaveUserInfo)}}]});this.render=function(){return t.render()}}function SysUserPassword(){var n={UpdatePassword:baseUrl+"/Home/UpdatePassword"},t=new Form("Password",{style:"form-block",fields:[{title:Language.CurrentPassword,field:"OldPassword",type:"password",required:!0},{title:Language.NewPassword,field:"NewPassword",type:"password",required:!0,tips:Language.PasswordTips},{title:Language.NewPassword1,field:"NewPassword1",type:"password",required:!0}],toolbar:[{text:Language.ConfirmUpdate,icon:"fa fa-check",handler:function(t){t.form.save(n.UpdatePassword)}}]});this.render=function(){return t.render()}}function SysUserMessage(){function e(n,t){for(var r,i=0;i<t.length;i++)r=t[i],$('<div class="um-box-button">').data("button",r).append('<i class="'+r.icon+'">').append("<span>"+r.text+"<\/span>").on("click",function(){$(".um-box-button").removeClass("active");$(this).addClass("active");var n=$(this).data("button");n.handler()}).appendTo(n)}function i(i){var r=o(i),u=new Grid("UserMessage",{url:n.QueryUserMessages,where:{Type:i},autoQuery:!1,toolButtons:r.toolButtons,columns:[{title:r.rsTitle,field:"MsgByName",width:"150px"},{title:"分类",field:"Category",width:"100px"},{title:"主题",field:"Subject"},{title:"时间",field:"CreateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"}]});t.html("");u.render().appendTo(t);Page.complete();setTimeout(function(){u.reload()},100)}function o(n){var i="",t=[];return n==="收件"?(i="发件人",t.push({name:"删除",icon:"fa fa-trash-o",handler:function(n){r(n)}}),t.push({name:"标记为",icon:"fa fa-bookmark-o",children:[{name:"已读",icon:"fa fa-envelope-open-o",handler:function(n){u(n,"已读")}},{name:"未读",icon:"fa fa-envelope-o",handler:function(n){u(n,"未读")}},{name:"全部设为已读",icon:"fa fa-envelope-open-o",handler:function(n){u(n,"全部已读")}}]})):n==="发件"?(i="收件人",t.push({name:"删除",icon:"fa fa-trash-o",handler:function(n){r(n)}})):n==="删除"&&(i="收发件人",t.push({name:"彻底删除",icon:"fa fa-trash-o",handler:function(n){r(n)}})),{rsTitle:i,toolButtons:t}}function r(t){t.deleteRows(n.DeleteUserMessages,function(){t.grid.reload()})}function u(t,i){i==="全部已读"?Layer.confirm("确定全部设为已读？",function(){Ajax.post(n.MarkUserMessages,{status:i,data:JSON.stringify(["1"])},function(){t.grid.reload()})}):t.selectRows(function(r){Ajax.post(n.MarkUserMessages,{status:i,data:JSON.stringify(r.ids)},function(){t.grid.reload()})})}var n={QueryUserMessages:baseUrl+"/System/QueryUserMessages",DeleteUserMessages:baseUrl+"/System/DeleteUserMessages",MarkUserMessages:baseUrl+"/System/MarkUserMessages"},t,f=[{text:"收件箱",icon:"fa fa-sign-in",handler:function(){i("收件")}},{text:"已发送",icon:"fa fa-sign-out",handler:function(){i("发件")}},{text:"已删除",icon:"fa fa-trash-o",handler:function(){i("删除")}}];this.render=function(){var n=$('<div class="fit">'),i=$('<div class="um-box-left">').appendTo(n);return e(i,f),t=$('<div class="um-box-right">').appendTo(n),n};this.mounted=function(){$(".um-box-button:eq(0)").click()}}function Dashboard(){function f(){this.render=function(n){new Card({icon:"fa fa-line-chart",title:"分析1",style:{marginRight:"5px"},body:'<div id="chartFlow" style="height:300px;"><\/div>'}).render().appendTo(n)};this.load=function(){var n=new Chart("chartFlow");n.setOption({title:{left:"center",text:""},tooltip:{trigger:"axis"},legend:{data:["PV","UV"]},xAxis:{splitLine:{show:!1},data:["06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30","10:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"]},yAxis:{},series:[{name:"PV",type:"line",data:[111,222,333,444,555,666,3333,33333,55555,66666,33333,3333,6666,11888,26666,38888,56666,42222,39999,28888,17777,9666,6555,5555,3333,2222,3111,6999,5888,2777,1666,999,888,777]},{name:"UV",type:"line",data:[11,22,33,44,55,66,333,3333,5555,12666,3333,333,666,1188,2666,3888,6666,4222,3999,2888,1777,966,655,555,333,222,311,699,588,277,166,99,88,77]}]})}}function e(){this.render=function(n){new Card({icon:"fa fa-pie-chart",title:"分析2",style:{marginLeft:"5px"},body:'<div id="chartBrowser" style="height:300px;"><\/div>'}).render().appendTo(n)};this.load=function(){var n=new Chart("chartBrowser");n.setOption({title:{left:"center",text:""},tooltip:{trigger:"item"},legend:{data:["Chrome","Firefox","IE 8.0","Safari","其它浏览器"]},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","50%"],data:[{value:9052,name:"Chrome"},{value:1610,name:"Firefox"},{value:3200,name:"IE 8.0"},{value:535,name:"Safari"},{value:1700,name:"其它浏览器"}]}]})}}var n,t,i,r=new f,u=new e;this.render=function(f){var h=$('<div class="fit">').appendTo(f),e=$('<div style="float:left;width:75%;">').appendTo(h),c=$('<div style="float:left;width:25%;">').appendTo(h),p=$('<div class="row row-first">').appendTo(e),w=$('<div class="card">').appendTo(p),o,s,l,a,v,y;Dashboard.createIconCards(w,[{name:"统计1",icon:"fa fa-th-list",value:20,width:"25%",style:{backgroundColor:"#00c0ef"}},{name:"统计2",icon:"fa fa-product-hunt",value:10,width:"25%",style:{backgroundColor:"#00a65a"}},{name:"统计3",icon:"fa fa-newspaper-o",value:5,width:"25%",style:{backgroundColor:"#dd4b39"}},{name:"统计4",icon:"fa fa-commenting-o",value:0,width:"25%",style:{backgroundColor:"#f0ad4e"}}]);o=$('<div class="row">').appendTo(e);Dashboard.createTodoList(o,{height:"200px"});n=Dashboard.createNotice(o,{height:"200px"});s=$('<div class="row">').appendTo(e);l=$('<div style="float:left;width:50%;">').appendTo(s);r.render(l);a=$('<div style="float:left;width:50%;">').appendTo(s);u.render(a);v=$('<div class="row row-first" style="padding-left:0;">').appendTo(c);t=Dashboard.createShortcut(v,{height:"351px"});y=$('<div class="row" style="padding-left:0;">').appendTo(c);i=Dashboard.createCommLink(y,{height:"300px"})};this.mounted=function(){n.load();t.load();i.load();r.load();u.load()}}$.extend(Page,{SysDictionary:{component:new SysDictionary}});$.extend(Page,{SysError:{component:new SysError}});$.extend(Page,{SysFile:{component:new SysFile}});$.extend(Page,{SysFlow:{component:new SysFlow}});$.extend(Page,{SysJob:{component:new SysJob}});$.extend(Page,{SysLog:{component:new SysLog}});$.extend(Page,{SysNoRule:{component:new SysNoRule}});$.extend(Page,{SysNotice:{component:new SysNotice}});Picker.action.organization={title:Language.SelectOrganization,type:"tree",width:350,height:350,url:baseUrl+"/System/GetOrganizations"};$.extend(Page,{SysOrganization:{component:new SysOrganization}});$.extend(Page,{SysRole:{component:new SysRole}});$.extend(Page,{SysServer:{component:new SysServer}});$.extend(Page,{SysSetting:{component:new SysSetting}});$.extend(Page,{SysSite:{component:new SysSite}});$.extend(Page,{SysTask:{component:new SysTask}});Picker.action.user={title:Language.SelectUser,url:baseUrl+"/System/QueryUsers",where:{OrgNo:curUser.CompNo},columns:[{title:Language.UserName,field:"UserName",width:"100px",query:!0},{title:Language.UserRealName,field:"Name",width:"100px",query:!0},{title:Language.Mobile,field:"Mobile",width:"120px"},{title:Language.Email,field:"Email",width:"150px"}],valueField:"UserName",textField:"Name"};$.extend(Page,{SysUser:{component:new SysUser(!1)},SysOrgUser:{component:new SysUser(!0)}});$.extend(Page,{SysUserInfo:{component:new SysUserInfo}});Dashboard.createIconCards=function(n,t){for(var i=0;i<t.length;i++)new IconCard(t[i]).render().appendTo(n)};Dashboard.createTodoList=function(n,t){var i=$('<div style="float:left;width:50%;">').appendTo(n);new Card({icon:"fa fa-tasks",title:Language.PeddingTask,style:{marginRight:"5px"},callback:function(n){n.body.css("height",t.height);n.body.html('<div id="todoList"><\/div>')}}).render().appendTo(i);BizFlow.loadTodos("todoList")};Dashboard.createNotice=function(n,t){var r=$('<div style="float:left;width:50%;">').appendTo(n),i;return new Card({icon:"fa fa-bell-o",title:Language.Notice,style:{marginLeft:"5px"},tool:'<span class="toolNotice">'+Language.More+"<\/span>",callback:function(n){n.body.css("height",t.height);n.body.html('<div id="noticeList"><\/div>');n.header.find(".toolNotice").on("click",function(){i.more()})}}).render().appendTo(r),i=new NoticeList("noticeList")};Dashboard.createShortcut=function(n,t){var i;return new Card({icon:"fa fa-external-link",title:Language.Shortcut,tool:'<span class="toolShortcut">'+Language.Set+"<\/span>",callback:function(n){n.body.css("height",t.height);n.body.html('<ul id="ulShortcut"><\/ul>');n.header.find(".toolShortcut").on("click",function(){i.add()})}}).render().appendTo(n),i=new UserLink("ulShortcut","shortcut")};Dashboard.createCommLink=function(n,t){var i;return new Card({icon:"fa fa-external-link",title:Language.CommonLink,tool:'<span class="toolCommlink">'+Language.Add+"<\/span>",callback:function(n){n.body.css("height",t.height);n.body.html('<ul id="ulLink"><\/ul>');n.header.find(".toolCommlink").on("click",function(){i.add()})}}).render().appendTo(n),i=new UserLink("ulLink","commlink")};$.extend(Page,{Dashboard:{component:new Dashboard}});