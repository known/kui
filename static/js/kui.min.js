function log(n){console.log(n)}function initDropdown(){$(".dropdown .title").on("mouseenter",function(){$(this).find(".arrow").removeClass("fa-caret-down").addClass("fa-caret-up");$(this).next().show()});$(".dropdown").on("mouseleave",function(){var n=$(this).find(".title");n.find(".arrow").removeClass("fa-caret-up").addClass("fa-caret-down");n.next().hide()})}function Form(n,t){function nt(){i.tabs?st(i.tabs):ct();i.style&&h.addClass(i.style);i.ahtml&&o.append(i.ahtml);u.body=o;lt(h);i.toolbar&&i.toolbar.length?tt(i.toolbar):o.css({bottom:0});i.url&&rt(i.url)}function st(n){var t,i,f;for(r.addClass("tabs tabs-fit tabs-form"),s=$('<div class="tabs-header">').appendTo(r),c=$('<div class="tabs-title">').appendTo(s),a=$("<ul>").appendTo(s),et(s),v=$('<div class="tabs-body">').appendTo(r),o=$('<div class="tabs-item active" style="padding:0;">').attr("id",g+"0").appendTo(v),h=$('<div class="form">').appendTo(o),t=0;t<n.length;t++)i=n[t],i.index=t,f=$("<li>").append(i.name).appendTo(a).data("item",i).on("click",function(){var n=$(this).data("item"),t;if(ht($(this),n),t=u.getData(),n.onClick)n.onClick({head:t,item:n.component});else n.component&&n.component.load&&n.component.load({head:t,isDetail:d})}),t===0&&f.addClass("active")}function ht(n,t){a.find("li").removeClass("active");n.addClass("active");var u=t.index||0,r=g+u,i=$("#"+r);i.length||(i=$('<div class="tabs-item">').attr("id",r).appendTo(v),new Router(i,{}).route(t));$(".tabs-item",v).removeClass("active");i.addClass("active")}function ct(){if(i.card?r.addClass("form-card form-dialog"):i.info&&r.addClass("form-info"),r.hasClass("form-card"))s=$('<div class="form-card-header">').appendTo(r),c=$('<div class="form-title">').appendTo(s),et(s),o=$('<div class="form-card-body">').appendTo(r),h=$('<div class="form">').appendTo(o);else if(r.hasClass("form-info")){var n=i.icon||"fa fa-window-maximize";s=$('<div class="form-info-header">').appendTo(r);c=$("<div>").append('<i class="'+n+'">').append(i.title).appendTo(s);o=$('<div class="form-info-body">').appendTo(r);h=$('<div class="form">').appendTo(o)}else o=r,h=r.length?r:$('<div class="form">').appendTo(o)}function lt(n){var s,f,t,o,u,h;if(i.fields&&i.fields.length)s=i.fields.filter(function(n){return n.type&&n.type!==""}),at(n,s);else for(f=r.find("input,select,textarea"),t=0;t<f.length;t++)o=$(f[t]),u=o.attr("name"),u&&u.length&&(h=e.filter(function(n){return n.name===u}),h.length||y(new Input(o)))}function tt(n){r.hasClass("form-card")?(f||(f=$('<div class="form-card-footer">').appendTo(r)),f.html(""),it(f,n),Utils.createButton({icon:"fa fa-close",text:Language.Close,style:"danger",handler:function(){u.close()}}).appendTo(f)):(f||(f=$('<div class="form-button">').appendTo(h),i.labelWidth&&f.css({marginLeft:i.labelWidth+20+"px"})),f.html(""),it(f,n))}function it(n,t){for(var r,i=0;i<t.length;i++)r=t[i],Utils.createButton(r,{form:u}).appendTo(n)}function rt(n){i.isPrint?$.ajax({url:n,"async":!1,success:function(n){u.setData(n)}}):Ajax.get(n,null,function(n){u.setData(n)})}function at(n,t){var f,i,r,e;for(n.html(""),f=0;f<t.length;f++)(i=t[f],i.visible===undefined||i.visible)&&(i.form=u,i.type==="hidden"?(e=new Input(n,i),y(e)):(i.label?w[i.label]?r=w[i.label]:(r=ft(n,i),w[i.label]=r):r=ft(n,i),i.type==="html"?ut(i,r):(e=new Input(r,i),y(e),ut(i,r)),i.unit&&$('<span class="form-unit">').html(i.unit).appendTo(r),i.tips&&$('<span class="form-tips">').html(i.tips).appendTo(r)))}function ut(n,t){if(n.inputHtml){var i=n.inputHtml;typeof i=="function"?i({form:u,parent:t}):$(i).appendTo(t)}}function ft(n,t){var f=t.label||t.title||"";f.length&&(f+="：");var u=$('<div class="form-item">').appendTo(n),o=$('<label class="form-label">').html(f).appendTo(u),e=$('<div class="form-input">').appendTo(u),s=r.hasClass("form-block");return(t.lineBlock||s&&t.type==="textarea")&&u.addClass("block"),(t.inputBlock||!s&&t.type==="textarea")&&e.addClass("block"),t.colSpan&&u.addClass(t.colSpan),t.required&&o.addClass("required"),i.labelWidth&&(o.css({width:i.labelWidth+"px"}),(t.inputBlock||t.lineBlock||t.type==="textarea")&&e.css({marginLeft:i.labelWidth+20+"px"})),e}function y(n){e.push(n);u[n.name]=n}function et(n){function u(n){n.mousedown(function(n){n.preventDefault();t.move=!0;t.offset=[n.clientX-parseFloat(r.css("left")),n.clientY-parseFloat(r.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),t.move){var i=n.clientX-t.offset[0],u=n.clientY-t.offset[1];r.css({left:i,top:u})}}).mouseup(function(){delete t.move})}var i=$('<div class="right-toolbar">').appendTo(n),t={};r.hasClass("form-dialog")?($('<i class="fa fa-window-maximize">').css({fontSize:"12px"}).data("isMax",!1).appendTo(i).click(function(){$(this).data("isMax")?($(this).data("isMax",!1).removeClass("fa-window-restore").addClass("fa-window-maximize"),r.removeClass("form-dialog-max").attr("style",$(this).data("layerStyle"))):($(this).data("isMax",!0).data("layerStyle",r.attr("style")).removeClass("fa-window-maximize").addClass("fa-window-restore"),r.addClass("form-dialog-max").attr("style","").css({zIndex:b+1}))}),u(n)):$('<i class="fa fa-chevron-up">').appendTo(i).click(function(){r.hasClass("collapse")?(r.removeClass("collapse"),$(this).removeClass("fa-chevron-down").addClass("fa-chevron-up")):(r.addClass("collapse"),$(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"))});$('<i class="fa fa-close">').appendTo(i).click(ot)}function ot(){$("#"+l+"Mask").remove();r.hide();i.onClose&&i.onClose()}var i=t,l=typeof n=="string"?"form"+n:n.attr("id"),r=typeof n=="string"?$("#"+l):n,p=i.title,w={},e=[],u=this,k,d,a,v,g=l+"-tab-",s,c,o,h,f,b=1e4;this.elem=r;this.body=null;this.option=i;this.data={};this.render=function(){return this.elem=r=$("<div>"),nt(),r};this.show=function(n,e){var v,nt,y,h,w,g;k=!0;d=e;n=n||{Id:""};p||(v=getCurTab(),p=v?v.title:"");s.length&&(c.html(""),nt=t.icon||"fa fa-window-maximize",c.append('<i class="'+nt+'">').append(p),y=n.Id===""?"【"+Language.New+"】":e?"【"+Language.Detail+"】":"【"+Language.Edit+"】",h="",i.titleInfo&&(h=i.titleInfo(n)),h.indexOf("【")>-1&&(y=""),c.append(y+h));u.setData(n,e);i.tabs&&a.find("li:eq(0)").click();f&&(e?f.hide():f.show(),i.tabs||o.css({bottom:(e?0:40)+"px"}));r.hasClass("form-card")&&($('<div class="mask">').attr("id",l+"Mask").css({zIndex:b}).appendTo($("body")),w=i.width||800,g=i.height||400,r.css({zIndex:b+1,width:w+"px",height:g+"px",marginTop:-(g/2)+"px",marginLeft:-(w/2)+"px"}));r.removeClass("collapse");r.show()};this.close=function(){k&&ot()};this.setToolbar=function(n){this.option.toolbar=n;tt(n)};this.validate=function(){for(var t,i=[],n=0;n<e.length;n++)t=e[n],t.validate()||i.push(t);return i.length===0};this.clear=function(){for(var t,n=0;n<e.length;n++)t=e[n],t.clearError(),t.setValue("")};this.getData=function(){for(var t,r,i={},u=[],n=0;n<e.length;n++)t=e[n],t.name&&t.type!=="html"&&(t.name.indexOf(".")>-1?(r=t.name.split("."),i[r[0]]||(u.push(r[0]),i[r[0]]={}),i[r[0]][r[1]]=t.getValue()):i[t.name]=t.getValue());if(u.length)for(n=0;n<u.length;n++)i[u[n]]=JSON.stringify(i[u[n]]);return i};this.setData=function(n,t){var o,r,f,s,h;for(this.data=n,o=0;o<e.length;o++)r=e[o],r.clearError(),r.data=n,t?r.setReadonly(!0):r.setReadonly(r.readonly),r.name&&r.name.indexOf(".")>-1?(f=r.name.split("."),$.isPlainObject(n[f[0]])||(n[f[0]]=JSON.parse(n[f[0]]||"{}")),r.setValue(n[f[0]][f[1]],t)):(s=n[r.name],r.setValue(s,t));h={form:u,data:n,isDetail:t};i.setData&&i.setData(h)};this.setReadonly=function(n){for(var i,t=0;t<e.length;t++)i=e[t],i.setReadonly(n)};this.setInput=function(n){y(n)};this.load=function(n,t){i.url=n;Ajax.get(n,null,function(n){u.setData(n);t&&t({form:u,data:n})})};this.reload=function(){rt(i.url)};this.save=function(n,t){function s(n){r.Id=n;i.tabs?u.show(r,!1):u.close();t&&t(r)}var r,f,e,o;u.validate()&&(r=u.getData(),i.onSaving&&i.onSaving(r),f=[],i.fields&&(f=i.fields.filter(function(n){return n.type&&n.type==="file"})),f.length?Ajax.upload(f[0].field,n,r,s):(e={data:JSON.stringify(r)},i.submitData&&(o=i.submitData(),$.extend(e,o)),Ajax.post(n,e,s)))};r.length&&(nt(),i.isPrint||Page.complete())}function Input(n,t){function w(){var t,f,e;_id=i.id||i.field;u=i.field;t=i.type;t==="label"?r=$('<div class="label">').appendTo(n):t==="radio"?h(n,i,i.code):t==="checkbox"?(f=i.code,f==="Enabled"?f=[{Code:1,Name:Language.Enable}]:i.label&&(f=[{Code:1,Name:f==="Enabled"?Language.Enable:i.title}]),f?h(n,i,f):(r=$('<input type="checkbox" value="1">').attr("name",u).appendTo(n),(i.value===1||i.value==="1")&&(r[0].checked=!0))):t==="picker"?(r=$('<input type="hidden">').attr("name",u).appendTo(n),new Picker(r,i)):(t==="select"?(r=$("<select>").appendTo(n),v()):t==="editor"?(r=$("<textarea>").attr("name",u).appendTo(n),g()):t==="textarea"?r=$("<textarea>").appendTo(n):t==="date"?(e=$('<div class="query-date">').appendTo(n),r=$('<input type="text" autocomplete="off">').appendTo(e),$('<span class="icon fa fa-calendar">').on("click",function(){r.focus()}).appendTo(e)):r=$('<input type="'+t+'" autocomplete="off">').appendTo(n),r.attr("name",u),t==="file"&&(r.attr("id",u),r.attr("accept",i.fileExt||".png,.jpg,.pdf,.doc,.docx.xls,.xlsx,.ppt,.pptx"),i.multiple&&r.attr("multiple","multiple")),i.placeholder&&r.attr("placeholder",i.placeholder),i.required&&r.attr("required",!0),i.inputStyle&&r.attr("style",i.inputStyle),i.readonly&&c(!0),i.change&&y(i.change));i.value&&l(i.value)}function b(){r=n;f=r.parent();u=r.attr("name");e=[];$.extend(i,{field:u,type:r[0].nodeName==="SELECT"?"select":r[0].type,required:r[0].required});i.type==="select"&&v()}function c(t){i.type!=="label"&&(t||i.type!=="picker")&&(i.type==="checkbox"||i.type==="radio"?n.find("input").attr("disabled",t):r&&(t?n.find(".icon").hide():n.find(".icon").show(),r.attr("disabled",t)))}function l(n){var h,c,a,e,t,v,l;if(s.value=n,i.type==="file")r.val(""),h=r.parent().find(".file"),h.length&&h.html(""),c=s.data[i.idField],c!==null&&c!==""&&c!==undefined&&(h.length||(h=$('<span class="file inline">').appendTo(r.parent())),$('<span class="link">').data("id",c).html(n).on("click",function(){BizFile.download($(this).data("id"))}).appendTo(h));else if(i.type==="label")a=n,i.code&&(a=Utils.getCodeName(i.code,n)),r.html(a);else if(i.type==="radio")for(e=f.find('input[name="'+u+'"]'),t=0;t<e.length;t++)e[t].checked=e[t].value===n;else if(i.type==="checkbox")for(e=f.find('input[name="'+u+'"]'),t=0;t<e.length;t++)v=e[t].value,e[t].checked=n===1||n===!0||n&&n.indexOf(v)>-1;else l=r.attr("placeholder"),l&&(n instanceof Date?n=n.format(l):isNaN(n)&&!isNaN(Date.parse(n))&&(n=new Date(n).format(l))),r.val(n),o&&o.txt.html(n)}function a(n,t){$.get(n,function(n){s.setData(n);t&&t(n)})}function h(n,t,i,r){var f,o,u;if((t.label||n.html(""),i)&&(e=Utils.getCodes(i),r=r||t.value,e&&e.length)){for(f=[],t.type==="select"&&(o="",o=t.emptyText!==undefined?t.emptyText:t.isQuery?Language.All:Language.PleaseSelect,o!==""&&f.push({Code:"",Name:o})),u=0;u<e.length;u++)f.push(e[u]);for(u=0;u<f.length;u++){var i=f[u],s=i.Code===""?"":i.Code||i,h=i.Name||s;t.type==="select"?k(n,f[u],s,h,r):d(n,f[u],s,h,t)}}}function v(){i.code&&h(r,i,i.code);i.url&&a(i.url)}function y(n){r.change(function(){var t=$(this);n&&n({form:i.form,elem:t,value:t.val(),selected:t.find(":selected").data("data")})})}function k(n,t,i,r,u){var f=$("<option>").data("data",t).attr("value",i).html(r).appendTo(n);u&&i===u&&f.attr("selected",!0)}function d(n,t,i,r,u){if(t.Code==="-"){$("<br>").appendTo(n);return}var f=$('<label class="form-radio">').appendTo(n),e=$("<input>").data("data",t).attr("type",u.type).attr("name",u.field).attr("value",i).appendTo(f),o=u.value;if(o&&i===o&&e.attr("checked",!0),u.onClick)e.on("click",function(){u.onClick($(this).val())});$("<span>").html(r).appendTo(f)}function g(){var n,f,i;window.wangEditor||Utils.addJs(baseUrl+"/static/libs/wangEditor.min.js");r.hide();n="editor"+u;f=r.before('<div id="'+n+'" class="editor">');o=new window.wangEditor("#"+n);o.config.onchange=function(n){r.val(n)};OssClient.config.accessKeyId?(i=new OssClient,o.config.customUploadImg=function(n,r){var e=t.form.OssUrl.getValue(),f=t.form.OssPath.getValue(),u;if(!e&&!f){Layer.tips("OSSPath"+Language.NotEmpty+"！");return}u=n[0];f+="/"+u.lastModified+u.name;i.put(f,u,function(n){r(e+n.name)})}):o.config.uploadImgServer=baseUrl+"/System/Upload";setTimeout(function(){o.create()},10)}var f=n,i=t||{},r,p=i.readonly===undefined?!1:t.readonly,u,e,o,s=this;t&&t.type?w():b();this.option=i;this.elem=r;this.readonly=p;this.name=u;this.type=i.type;this.value="";this.data={};this.validate=function(){if((s.clearError(),i.type==="hidden")||i.type==="checkbox"&&e&&e.length===1)return!0;var n=$.trim(s.getValue());return r&&!r[0].disabled&&i.required&&n===""?(f.addClass("error"),!1):i.required&&n===""?(f.addClass("error"),!1):!0};this.clearError=function(){f.removeClass("error")};this.getValue=function(){var n,t;return i.type==="label"?s.value:i.type==="radio"?f.find('input[name="'+u+'"]:checked').val()||"":i.type==="checkbox"?(n=f.find('input[name="'+u+'"]'),n.length===1?n[0].checked?1:0:(t=[],f.find('input[name="'+u+'"]:checked').each(function(n,i){t.push($(i).val())}),t.join(","))):r.val()};this.setValue=function(n,t){l(n,t)};this.setReadonly=function(n){c(n)};this.setVisible=function(n){n?f.parent().show():f.parent().hide()};this.setUrl=function(n,t){a(n,t)};this.getData=function(){if(i.type==="select")return r.find(":selected").data("data");var n=[];return f.find("input:checked").each(function(t,i){n.push($(i).data("data"))}),n};this.setData=function(n,t){h(r,i,n,t)};this.change=function(n){y(n)};this.setUnit=function(t,i){var r=n.find(".form-unit").html(t);i&&r.css(i)};this.setTips=function(t,i){var r=n.find(".form-tips").html(t);i&&r.css(i)}}function Picker(n,t){function c(){var n=u.pick||{},t;n.action&&(n=Picker.action[n.action]||{},$.extend(!0,n,u.pick));f=n.multiSelect||!1;t=$('<span class="icon fa fa-ellipsis-h">').on("click",function(){l(n)});n.valueField===n.textField?(i.attr("type","text").attr("disabled",!0),t.insertAfter(i)):(r=$('<input type="text">').attr("name",o+"Name").attr("disabled",!0).insertAfter(i),u.form&&u.form.setInput(new Input(r,{readonly:!0})),t.insertAfter(r))}function l(n){var t,i=Layer.open({title:n.title,width:n.width||600,height:n.height||400,content:function(r){n.type==="tree"?t=new Tree("treePick",{url:n.url}):(n.showCheckBox=!0,n.multiSelect=f,f||(n.dblclick=function(t){s(i,n,[t.row])}),t=new Grid("Pick",n));t.render().appendTo(r);n.onLoad&&n.onLoad({form:u.form,control:t,option:n})},buttons:[{text:Language.OK,handler:function(){var u,r;if(n.type==="tree"){if(u=t.selectedNode,!u){Layer.tips(Language.PleaseSelect+Language.Node+"！");return}a(i,n,u)}else{if(r=t.getSelected(),f){if(!r||r.length===0){Layer.tips(Language.PleaseSelectOneAtLeast);return}}else if(!r||r.length===0||r.length>1){Layer.tips(Language.PleaseSelectOne);return}s(i,n,r)}}}]})}function a(n,i,r){var u={form:t.form};u.value=r.id;u.text=r.title;u.data=r.data;h(u);i.callback&&i.callback(u);n.close()}function s(n,i,r){var u={form:t.form},s,c,e,o;if(f){for(s=[],c=[],e=0;e<r.length;e++)s.push(r[e][i.valueField]),c.push(r[e][i.textField]);u.value=s.join(",");u.text=c.join(",");u.data=r}else o=r[0],u.value=o[i.valueField],u.text=o[i.textField],u.data=o;h(u);i.callback&&i.callback(u);n.close()}function h(n){i.data(e,n.data);i.val(n.value);r&&r.val(n.text)}var i=typeof n=="string"?$('[name="'+n+'"]'):n,u=t||{},f=!1,o=i.attr("name"),r,e="data";c();this.name=o;this.validate=function(){var n=$.trim(this.getValue());return!i[0].disabled&&i[0].required&&n===""?!1:!0};this.getValue=function(){var n=i.data(e);return n&&n.value?n.value:i.val()};this.getData=function(){var n=i.data(e);return n&&n.data?n.data:null};this.setValue=function(n,t){i.val(n);r&&r.val(t)}}function Grid(n,t){function kt(n){o.html('<tr><td colspan="'+v+'" class="center error">'+n+"<\/td><\/tr>")}function dt(n){o.html('<tr><td colspan="'+v+'" class="center">'+Language.Loading+"......<\/td><\/tr>");$.ajax({type:"post",url:t.url,data:n,cache:!1,"async":!0,success:function(n){$.isArray(n)?(r.total=n.length,gt(n)):(r.total=n.count,ai(n.count),gt(n.data),t.summary&&t.summary(n.summary))},error:function(){kt(Language.ServerError)}})}function gt(n){t.setData?t.setData({grid:r,data:n}):r.setData(n)}function y(n){nt===0||n<=0||n>nt||(f.page=n,r.reload(null,0))}function ni(n,t){t=t||"";t==="center"?n.addClass("center"):t==="right"&&n.addClass("text-right")}function hi(n){if(n.action){var i=$("<span>").addClass("link").data("action",n.action);n.icon?i.addClass(n.icon):i.html(n.title);i.on("click",function(){var n=$(this).data("action");ft[n]&&ft[n].call(this,{grid:r,form:t.form})});return i}return n.title}function ti(n,i,u){var s=$("<tr>").appendTo(o),y,c,f,e,l,h,v,a;for(n&&(i+1)%2==0&&s.addClass("alter"),b&&s.append('<td class="center">'+(i+1)+"<\/td>"),ot&&!st&&(e=$('<td class="center checkbox">').appendTo(s),y=tt?'<input type="checkbox">':'<input type="radio" name="gridCheck">',$(y).data(d,u).on("change",function(){$(this).is(":checked")?pt($(this),!0):pt($(this),!1)}).appendTo(e)),lt.length>0&&!t.isTradition&&!st&&(e=$('<td class="center btns">').data(d,u).appendTo(s),wi(e)),c=0;c<et.length;c++){if(f=et[c],e=$("<td>").appendTo(s),ni(e,f.align),f.field&&f.field.indexOf(".")>-1&&(l=f.field.split("."),$.isPlainObject(u[l[0]])||(u[l[0]]=JSON.parse(u[l[0]]||"{}"))),f.format?(h=f.format,typeof h=="string"&&h==="detail"&&(h=function(n,t){return $('<span class="link">').html(u[f.field]).data("data",n).on("click",function(){var n=$(this).data("data");t.form&&t.form.show(n,!0)})}),a=h(u,{index:i,tr:s,td:e,column:f,grid:r,form:t.form}),e.append(a)):f.field&&ci(e,f,u),ot){v=tt?":checkbox":":radio";e.on("click",function(){yt(!1);var n=$(this).parent(),t=n.find(v);t[0].checked=!t.is(":checked");t[0].checked?n.addClass("selected"):n.removeClass("selected")});if(t.dblclick)e.on("dblclick",function(){var n=$(this).parent(),i=n.find(v),r=i.data(d);t.dblclick({row:r})})}if(f.actionFormat){a=f.actionFormat(u,{index:i,tr:s,td:e,column:f});e.append(a);s.find("[action]").on("click",function(){ii();var n=$(this).attr("action"),u=$(this).parentsUntil("tbody").last(),i=o.find("tr").index(u),f=r.data[i];ft[n]&&ft[n].call(this,{grid:r,form:t.form,row:f,index:i})})}}}function ii(){l&&o.find("tr").each(function(n,t){$(t).find("input,select,textarea").each(function(t,i){var u=new Input($(i));u.name&&(r.data[n][u.name]=u.getValue())})})}function ci(n,t,i){var r,f,u,e;if(n.html(""),t.field.indexOf(".")>-1?(f=t.field.split("."),r=i[f[0]][f[1]]):r=i[t.field],l&&t.type){t.value=r||"";new Input(n,t);return}if(r!==null&&r!==undefined&&r!=="")if(t.type==="file")$('<span class="link">').data("id",i[t.idField]).html(Language.Attachment).appendTo(n).on("click",function(){BizFile.download($(this).data("id"))});else u=r,t.placeholder?r instanceof Date?u=r.format(t.placeholder):isNaN(r)&&!isNaN(Date.parse(r))&&(u=new Date(r).format(t.placeholder)):t.code?"YesNo,HasNot,Enabled".indexOf(t.code)>-1?((r==="1"||r==="0")&&(r=parseInt(r)),u=vt(t.code,r),e=r===1?"success":"gray",u='<span class="badge '+e+'">'+u+"<\/span>"):u=vt(t.code,r):u=r||r===0?r:"",n.html(u)}function vt(n,t){return(t||t===0)?Utils.getCodeName(n,t):""}function li(){var n=$('<th class="check">').appendTo(a);tt&&$('<input type="checkbox">').on("change",function(){$(this).is(":checked")?yt(!0):yt(!1)}).appendTo(n)}function yt(n){var t=tt?":checkbox":":radio";i.find("tbody "+t).each(function(){pt($(this),n)});!n&&tt&&(i.find(".check "+t)[0].checked=!1)}function pt(n,t){n[0].checked=t;t?n.parent().parent().addClass("selected"):n.parent().parent().removeClass("selected")}function ri(n,t,r){var u,s,f,e,o;g=!0;i.find("tbody tr").removeClass("selected");u=i.find("tbody tr:eq("+t+")").addClass("selected");r?(s=n[t],$.post(r,{id:s.Id,direct:"up"},function(){ri(n,t)})):(n.splice(t-1,0,n[t]),n.splice(t+1,1),f=u.prev(),u.insertBefore(f),b&&(e=f.find("td:first"),e.html(parseInt(e.html())+1),o=u.find("td:first"),o.html(parseInt(o.html())-1)),g=!1)}function ui(n,t,r){var u,s,f,e,o;g=!0;i.find("tbody tr").removeClass("selected");u=i.find("tbody tr:eq("+t+")").addClass("selected");r?(s=n[t],$.post(r,{id:s.Id,direct:"up"},function(){ui(n,t)})):(n.splice(t+2,0,n[t]),n.splice(t,1),f=u.next(),f&&u.insertAfter(f),b&&(e=u.find("td:first"),e.html(parseInt(e.html())+1),o=f.find("td:first"),o.html(parseInt(o.html())-1)),g=!1)}function ai(n){e.length&&(nt=Math.ceil(n/f.limit),e.find(".pi").val(f.page),e.find(".pc").html(nt),e.find(".pt").html(n))}function wt(){k&&setTimeout(function(){var n=0;t.isTradition?(c&&(n+=c.elem[0].clientHeight),u&&(n+=u.elem[0].clientHeight)):c?n+=c.elem[0].clientHeight:u&&(n+=u.elem[0].clientHeight);n===0&&(n=5);s.css({top:n+"px"})},10)}function fi(){if(st=!1,t.width&&i.css({width:t.width}),a=i.find("thead tr"),!a.length){var n=$("<thead>").appendTo(i);a=$("<tr>").appendTo(n)}o=i.find("tbody");o.length||(o=$("<tbody>").appendTo(i));e=i.parent().find(".page");ht&&!e.length&&vi();k&&s.addClass("grid-fixed");yi();t.columns&&r.setColumns(t.columns);pi();bi();wt();t.url&&oi&&r.reload(t.where)}function vi(){var t,n,i,r;e=$('<div class="pager">');t=$('<span class="pn">').appendTo(e);$('<i class="fa fa-refresh" title="'+Language.Refresh+'">').on("click",function(){y(f.page)}).appendTo(t);$('<i class="fa fa-step-backward" title="'+Language.First+'">').on("click",function(){y(1)}).appendTo(t);$('<i class="fa fa-caret-left" title="'+Language.Previous+'">').on("click",function(){y(f.page-1)}).appendTo(t);$('<i class="fa fa-caret-right" title="'+Language.Next+'">').on("click",function(){y(f.page+1)}).appendTo(t);$('<i class="fa fa-step-forward" title="'+Language.Last+'">').on("click",function(){y(nt)}).appendTo(t);n=$('<span class="pm">').appendTo(e);n.append(Language.PagerNavTo);$('<input type="text" class="pi">').on("change",function(){y($(this).val())}).appendTo(n);n.append('/<span class="pc"><\/span>'+Language.PagerPerPage);i=$('<select class="ps">').on("change",function(){f.limit=$(this).val();y(1)}).appendTo(n);$(si).each(function(n,t){i.append('<option value="'+t+'">'+t+"<\/option>")});r=Utils.format(Language.PagerTotal,'<span class="pt"><\/span>');n.append(r);n.append("<\/span>");s.after(e);k&&(e.addClass("pager-fixed"),s.css({bottom:"30px"}))}function yi(){if(t.footer){var n=$('<div class="grid-footer">').append(t.footer).appendTo(s.parent());k&&(n.addClass("grid-footer-fixed"),setTimeout(function(){var t=n.outerHeight();e.length&&(e.css({bottom:t+"px"}),t+=30);s.css({bottom:t+"px"})},100))}}function pi(){if(w.length){var n={buttons:w,toolbar:t.toolbar,toolbarTips:t.toolbarTips,isTradition:!p.length||t.isTradition,gridParameter:function(){var n=r.getSelected();return new GridManager(r,t.form,n)}};p.length&&t.isTradition&&(n.query=function(){u.elem.hasClass("hide")?u.elem.removeClass("hide").css({paddingTop:0}):u.elem.addClass("hide").css({paddingTop:"5px"});wt()});c=new Toolbar(n);s.before(c.render())}}function wi(n){var i={buttons:lt,toolbar:t.toolbar,isGridCell:!0,onlyIcon:t.isIconButton,gridParameter:function(){var i=[n.data(d)];return new GridManager(r,t.form,i)}},u=new Toolbar(i);u.render(n)}function bi(){if(p.length){u=new Query({id:ei,grid:r,querys:p,isTradition:t.isTradition,onSearch:t.onSearch});w.length&&t.isTradition&&u.elem.addClass("hide");var n=r.columns.filter(function(n){return n.export});!w.length&&(t.showBtnExport||n.length>0)&&Utils.createButton({icon:"fa fa-sign-out",text:Language.Export,handler:function(){var n=new GridManager(r,t.form);n.export()}}).appendTo(u.elem);s.before(u.elem)}}var rt="grid"+n,c,ei=rt+"Query",u,p=[],i=$("#"+rt),b=t.index===undefined?!0:t.index,k=t.fixed===undefined?!0:t.fixed,l=t.edit,ut=t.import,oi=t.autoQuery===undefined?t.url?!0:!1:t.autoQuery,ht=t.page===undefined?t.url?!0:!1:t.page,si=[10,20,50,100,500,1e3],ft=$.extend({add:function(n){n.grid.addRow(t.row||{})},remove:function(n){n.grid.removeRow(n.index)},up:function(n){n.grid.moveRow(n.index,"up",t.moveRowUrl)},down:function(n){n.grid.moveRow(n.index,"down",t.moveRowUrl)}},t.action||{}),d="row",r=this,g=!1,ct,s=i.parent(),f={field:"",order:""},nt=0,v=0,et=[],a,o,e,w=t.toolButtons||[],lt=w.filter(function(n){return n==="edit"||n==="remove"||n.target&&n.target.indexOf("grid")>=0}),ot=t.showCheckBox||!ut&&w.length>0,tt=t.multiSelect===undefined?!0:t.multiSelect,st=!1,h={},at,bt,it;if(t.sortField)for(at=t.sortField.split(","),bt=t.sortOrder.split(","),it=0;it<at.length;it++)h[at[it]]=bt[it];l&&(b=!1,t.fixed===undefined&&(k=!1));(l||ut)&&(ht=!1,ot=!1);ht&&(f.page=1,f.limit=10);this.elem=i;this.option=t;this.name=n;this.columns=[];this.data=[];this.where=t.where||{};this.total=0;this.render=function(){return rt="grid"+n,_gridTop=0,ct=$('<div class="grid-view">'),s=$('<div class="grid">').appendTo(ct),i=$("<table>").attr("id",rt).appendTo(s),fi(),ct};this.setDetail=function(n){st=n;c&&(n?c.elem.hide():c.elem.show());u&&(n?u.elem.removeClass("hide").css({paddingTop:"5px"}):t.isTradition&&u.elem.addClass("hide"));n?i.find("th.check,th.tb-head").hide():i.find("th.check,th.tb-head").show();wt()};this.setIsEdit=function(n){l=n};this.setColumns=function(n){var o,u,s,e;for(et=[],n=n||[],t.showModifyBy&&(n.push({title:Language.ModifyBy,field:"ModifyBy",width:"100px"}),n.push({title:Language.ModifyTime,field:"ModifyTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"})),t.showCreateBy&&(n.push({title:Language.CreateBy,field:"CreateBy",width:"100px"}),n.push({title:Language.CreateTime,field:"CreateTime",width:"140px",placeholder:"yyyy-MM-dd HH:mm:ss"})),this.columns=n,v=0,a.html(""),b&&(v+=1,$('<th class="index">').appendTo(a)),ot&&(v+=1,li()),lt.length>0&&!t.isTradition&&(v+=1,$('<th class="center tb-head">').html(Language.Operate).appendTo(a)),p=t.querys||[],o=0;o<n.length;o++)if((u=n[o],!u.query||l||ut||p.push($.extend({prefixType:"LG"},u)),u.hideColumn===undefined||!u.hideColumn)&&(u.visible===undefined||u.visible)){if(s=hi(u),e=$("<th>").append(s).appendTo(a),u.width&&e.css({width:u.width}),u.field&&e.attr("field",u.field),ni(e,u.align),ut)u.required&&e.addClass("red"),u.code&&e.append(" *").css({cursor:"pointer"}).data("column",u).click(function(){var r=$(this).data("column"),u=Utils.getCodes(r.code),n='<h3 style="padding:10px;">'+r.title+Language.CodeOptionTip+"<\/h3>",i,t,f;for(n+='<div style="padding:0 10px 10px 10px;">',i=0;i<u.length;i++)t=u[i],f=t.Code===0?0:t.Code||t,n+="<p>"+f,t.Name&&(n+="-"+t.Name),n+="<\/p>";n+="<\/div>";Layer.open({width:300,height:200,content:n,showClose:!0})});else{if(u.sort||h[u.field]){e.addClass("sorting").append('<i class="fa fa-caret-down"><\/i><i class="fa fa-caret-up"><\/i>');e.on("click",function(){var n=$(this),t=n.attr("field");h={};h[t]=f.order==="asc"?"desc":"asc";i.find("th").removeClass("asc desc");n.addClass(h[t]);r.reload()})}e.removeClass("asc desc");h[u.field]&&e.addClass(h[u.field])}et.push(u);v+=1}};this.setData=function(n){this.data=n||[];o.html("");n.length||l?$(n).each(function(n,t){ti(!l,n,t)}):kt(Language.NoDataFound)};this.reload=function(n,i){var s=u?u.getData():{},r,e,o;if($.extend(this.where,n||{},s),t.querys)dt(this.where);else{f.load=i===0?0:1;f.query=JSON.stringify(this.where);r=[];e=[];for(o in h)r.push(o),e.push(h[o]);f.field=r.join(",");f.order=e.join(",");dt(f)}};this.getSelected=function(){var n=[];return i.find("tbody .checkbox :checked").each(function(){var i=$(this).parent().parent(),r=o.find("tr").index(i),t=$(this).data(d);t.index=r;n.push(t)}),n};this.addRow=function(n){ti(!1,this.data.length,n);this.data.push(n)};this.removeRow=function(n){o.find("tr:eq("+n+")").remove();this.data.splice(n,1)};this.moveRow=function(n,t,i){if(!g)if(t==="up"){if(n===0){Layer.tips(Language.CanNotMoveUp);return}ri(this.data,n,i)}else if(t==="down"){if(n>=this.data.length-1){Layer.tips(Language.CanNotMoveDown);return}ui(this.data,n,i)}};this.getData=function(){return ii(),r.data};this.getValue=function(n,t){var i=n[t.field];if(i===null)return"";if(t.valueFormat)return t.valueFormat({value:i,row:n,column:t});if(t.placeholder){if(i instanceof Date)return i;if(isNaN(i)&&!isNaN(Date.parse(i)))return new Date(i)}else return t.code?vt(t.code,i):i||i===0?i:""};this.validate=function(){return!0};i.length&&fi()}function GridManager(n,t,i){function f(){GridManager.isLoad||(Utils.addJs(baseUrl+"/static/libs/xlsx.core.min.js"),GridManager.isLoad=!0)}function e(n,t,i){var r=n.rows.length,u=r>1?Utils.format(Language.SelectRecord,r):Language.TheRecord,f=Utils.format(Language.ConfirmDeleteTips,u);Layer.confirm(f,function(){Ajax.post(t,{data:JSON.stringify(n.ids)},function(){i?i(n):n.grid.reload()})})}function o(n,t){var i,r;return t=t||"Sheet1",i={SheetNames:[t],Sheets:{}},i.Sheets[t]=n,r={bookType:"xlsx",bookSST:!1,type:"binary"},XLSX.write(i,r)}var r=t?t.title:"",u;r||(u=getCurTab(),r=u?u.title:"");this.grid=n;this.rows=i;this.row=i&&i.length?i[0]:null;this.selectRow=function(r){if(!i||i.length===0||i.length>1){Layer.tips(Language.PleaseSelectOne);return}var u=i[0];r&&r({grid:n,form:t,rows:i,row:u,index:u.index,ids:[u.Id]})};this.selectRows=function(r){if(!i||i.length===0){Layer.tips(Language.PleaseSelectOneAtLeast);return}var u=i.map(function(n){return n.Id});r&&r({grid:n,form:t,rows:i,ids:u})};this.addRow=function(n){t.show(n)};this.editRow=function(n){this.selectRow(function(i){(!n||n(i))&&t.show(i.row)})};this.deleteRow=function(n,t){this.selectRow(function(i){e(i,n,t)})};this.deleteRows=function(n,t){this.selectRows(function(i){e(i,n,t)})};this.moveRow=function(n,t){this.selectRow(function(i){i.grid.moveRow(i.index,n,t)})};this.import=function(i,u){f();var e,s=n.columns.slice().filter(function(n){return n.import});Layer.open({title:r+"【"+Language.Import+"】",width:1024,height:450,content:function(n){var t=$('<div class="import-tips">').appendTo(n);t.append(Language.ImportTips);$('<div class="import-body">').append('<div class="grid"><table id="gridImport"><\/table><\/div>').appendTo(n)},success:function(){var n=[{title:Language.ValidInfo,field:"Error",format:function(n,t){return n.Error&&n.Error.length?(t.tr.css({color:"#f00"}),'<span class="red">'+n.Error+"<\/span>"):""}}].concat(s);e=new Grid("Import",{"import":!0,columns:n});Utils.paste(!0,function(n){var h=[],u=n.split("\n"),r,f,o,i;if(u.length>1e3){Layer.tips(Language.ImportMaxLength);return}for(r=0;r<u.length;r++)if(u[r].length){for(f=$.extend({},t.data),o=u[r].replace("\r","").split("\t"),i=0;i<s.length;i++)o.length>i&&(f[s[i].field]=o[i]);h.push(f)}e.setData(h)})},buttons:[{text:Language.ImportRule,handler:function(){for(var u,t=[],i=[],n=0;n<s.length;n++)i.push(s[n].title);t.push(i);u=XLSX.utils.aoa_to_sheet(t);Utils.genFile(o(u),r+Language.ImportRule+".xlsx")}},{text:Language.Import,handler:function(t){var r=e.getData(),f,o;if(!r.length){Layer.tips(Language.PleasePasteImport);return}if(!e.validate()){Layer.tips(Language.DataNotValidPleaseCheck);return}f=Layer.loading(Language.Importing+"......");o=$.extend({},u,{data:JSON.stringify(r)});$.post(i,o,function(i){var u,o,r;if(f.close(),i.ok)Layer.tips(i.message),t.close(),Utils.paste(!1),n.reload();else if(Layer.alert(i.message),u=i.data,u&&u.length){for(o=e.data,r=0;r<o.length;r++)o[r].Error=u[r];e.setData(o)}})}}]})};this.export=function(t){var s,i,l,e,a,v;f();var h=[],c=[],u=n.columns;for(i=0;i<u.length;i++)u[i].export&&c.push(u[i].title);if(c.length===0){Layer.tips(Language.NotExportColumn);return}if(s=n.getData(),s.length===0){Layer.tips(Language.NotExportData);return}for(h.push(c),i=0;i<s.length;i++){for(l=[],e=0;e<u.length;e++)u[e].export&&(a=n.getValue(s[i],u[e]),l.push(a));h.push(l)}v=XLSX.utils.aoa_to_sheet(h);Utils.genFile(o(v),(t||r)+".xlsx")}}function Card(n){function f(){i=$('<div class="card">');r=$('<div class="card-header">').appendTo(i);t.icon&&$("<span>").addClass(t.icon).appendTo(r);t.title&&$("<span>").html(t.title).appendTo(r);t.tool&&$('<span class="tool">').html(t.tool).appendTo(r);u=$('<div class="card-body">').appendTo(i);t.style&&i.css(t.style);t.body&&u.html(t.body);t.callback&&t.callback({header:r,body:u})}var t=n||{},i,r,u;this.option=t;this.render=function(){return f(),i}}function IconCard(n){function u(){var n,f,u;i=$('<div class="small-box">').attr("id",t.id).css("width",t.width);n=$('<div class="inner">').appendTo(i);f=t.value;r=$("<h3>").html(t.value||"0").appendTo(n);$("<p>").html(t.name).appendTo(n);u=$('<div class="icon">').appendTo(n);$("<i>").addClass(t.icon).appendTo(u);t.style&&n.css(t.style)}var t=n||{},i,r;this.option=t;this.render=function(){return u(),i};this.setValue=function(n){r.html(n)}}function Chart(n){Chart.isLoad||(Utils.addJs(baseUrl+"/static/libs/echarts.min.js"),Chart.isLoad=!0);var t=echarts.init(document.getElementById(n));this.clear=function(){t.clear()};this.setOption=function(n){t.setOption(n)};this.setLine=function(n){t.setOption(n)};this.setPie=function(n){t.setOption(n)}}function FlowArrow(n,t,i,r){this.x1=n;this.y1=t;this.x2=i;this.y2=r;this.tmpX1=null;this.tmpY1=null;this.tmpX2=null;this.tmpY2=null;this.color="black";this.setColor=function(n){this.color=n};this.setP=function(n,t,i,r){this.x1=n;this.y1=t;this.x2=i;this.y2=r};this.setP1=function(n,t){this.tmpX1=n;this.tmpY1=t};this.setP2=function(n,t){this.tmpX2=n;this.tmpY2=t};this.drawBottomToTop=function(n,t){this.x1!=this.x2?(this.setP1(this.x1,(this.y1+this.y2)/2),this.setP2(this.x2,(this.y1+this.y2)/2),this.draw(n)):this.draw(n);t&&t.text&&n.fillText(t.text,this.x1+1,(this.y1+this.y2)/2)};this.drawBottomToRight=function(n,t){this.y1!=this.y2?(this.setP1(this.x1,this.y2),this.draw(n)):this.draw(n);t&&t.text&&n.fillText(t.text,this.x1+1,(this.y1+this.y2)/2)};this.drawLeftOrRightToTop=function(n,t){this.setP1(this.x2,this.y1);this.draw(n);t&&t.text&&n.fillText(t.text,this.x2+1,(this.y1+this.y2)/2)};this.drawLeftToRightOrRightToLeft=function(n,t){if(t=t||{},this.y1!=this.y2){var i=t.offsetX||0;this.setP1((this.x1+this.x2+i)/2,this.y1);this.setP2((this.x1+this.x2+i)/2,this.y2);this.draw(n);t.text&&n.fillText(t.text,(this.x1+this.x2+i)/2+1,(this.y1+this.y2)/2)}else this.draw(n),t.text&&n.fillText(t.text,(this.x1+this.x2)/2+1,(this.y1+this.y2)/2+15)};this.drawRightToLeftOrLeftToRight=function(n,t){if(t=t||{},this.y1!=this.y2){var i=t.offsetX||0;this.setP1((this.x1+this.x2+i)/2,this.y1);this.setP2((this.x1+this.x2+i)/2,this.y2);this.draw(n);t&&t.text&&n.fillText(t.text,(this.x1+this.x2+i)/2+1,(this.y1+this.y2)/2)}else this.draw(n),t.text&&n.fillText(t.text,(this.x1+this.x2)/2+1,(this.y1+this.y2)/2+15)};this.draw=function(n){var t;n.strokeStyle=this.color;n.fillStyle=this.color;n.beginPath();n.moveTo(this.x1,this.y1);this.tmpX1!=null&&this.tmpY1!=null&&this.tmpX2!=null&&this.tmpY2!=null?(n.lineTo(this.tmpX1,this.tmpY1),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(this.tmpX1,this.tmpY1),n.lineTo(this.tmpX2,this.tmpY2),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(this.tmpX2,this.tmpY2),n.lineTo(this.x2,this.y2),n.closePath(),n.stroke(),t=Math.atan((this.y2-this.tmpY2)/(this.x2-this.tmpX2)),t+=(this.x2>=this.tmpX2?90:-90)*Math.PI/180,this.drawArrowhead(n,this.x2,this.y2,t)):this.tmpX1!=null&&this.tmpY1!=null&&this.tmpX2==null&&this.tmpY2==null?(n.lineTo(this.tmpX1,this.tmpY1),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(this.tmpX1,this.tmpY1),n.lineTo(this.x2,this.y2),n.closePath(),n.stroke(),t=Math.atan((this.y2-this.tmpY1)/(this.x2-this.tmpX1)),t+=(this.x2>=this.tmpX1?90:-90)*Math.PI/180,this.drawArrowhead(n,this.x2,this.y2,t)):this.tmpX1==null&&this.tmpY1==null&&this.tmpX2==null&&this.tmpY2==null&&(n.lineTo(this.x2,this.y2),n.closePath(),n.stroke(),t=Math.atan((this.y2-this.y1)/(this.x2-this.x1)),t+=(this.x2>=this.x1?90:-90)*Math.PI/180,this.drawArrowhead(n,this.x2,this.y2,t))};this.drawArrowhead=function(n,t,i,r){n.save();n.beginPath();n.translate(t,i);n.rotate(r);n.moveTo(0,0);n.lineTo(5,10);n.lineTo(-5,10);n.closePath();n.restore();n.fill()}}function FlowStep(n,t,i){function r(t){if(typeof t=="string"){var i=n.steps.filter(function(n){return n.id===t});t=i.length>0?i[0]:null}return t}function e(n,t,i,r,u,f){var e=u/2;n.beginPath();n.moveTo(t+e,i);n.arcTo(t+r,i,t+r,i+u,e);n.arcTo(t+r,i+u,t,i+u,e);n.arcTo(t,i+u,t,i,e);n.arcTo(t,i,t+r,i,e);n.closePath();n.fillText(f,t+10,i+30);n.stroke()}function o(n,t,i,r,u){n.beginPath();n.moveTo(t,i+r);n.lineTo(t-r*2,i);n.lineTo(t,i-r);n.lineTo(t+r*2,i);n.closePath();n.fillText(u,t-r-8,i+5);n.stroke()}var u=i.x,f=i.y;this.id=i.id;this.name=i.name;this.item=i;this.flag=i.flag;this.chart=n;this.l=30;this.h=50;this.w=2*this.h;this.x=u;this.y=f;i.round?e(t,u-this.w/2,f-this.h/2,this.w,this.h,i.name):i.flag==="condition"?o(t,u,f,this.l,i.name):(t.strokeRect(u-this.w/2,f-this.h/2,this.w,this.h),t.fillText(i.name,u-this.w/2+10,f+5));this.contains=function(n,t){if(this.flag==="condition")return n>=this.x-this.l*2&&t>=this.y-this.l&&n<=this.x+this.l*2&&t<=this.y+this.l*2;var i=this.x-this.w/2,r=this.y-this.h/2;return n>=i&&t>=r&&n<=i+this.w&&t<=r+this.h};this.drawBottomToTop=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.h/2:this.l;n.flag=="step"?(u=new FlowArrow(this.x,this.y+f,n.x,n.y-n.h/2),u.drawBottomToTop(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x,this.y+f,n.x,n.y-n.l),u.drawBottomToTop(t,i))};this.drawBottomToLeft=function(n,i){n=r(n);n.flag=="step"?(arrow=new Arrow(this.x,this.y+this.h/2,n.x-n.w/2,n.y),arrow.drawBottomToRight(t,i)):n.flag=="condition"&&(arrow=new Arrow(this.x,this.y+this.h/2,n.x-n.l*2-40,n.y),arrow.drawBottomToRight(t,i))};this.drawBottomToRight=function(n,i){n=r(n);n.flag=="step"?(arrow=new Arrow(this.x,this.y+this.h/2,n.x+n.w/2,n.y),arrow.drawBottomToRight(t,i)):n.flag=="condition"&&(arrow=new Arrow(this.x,this.y+this.h/2,n.x+n.l*2+40,n.y),arrow.drawBottomToRight(t,i))};this.drawLeftToTop=function(n,i){var u;n=r(n);n.flag=="step"?(u=new FlowArrow(this.x-this.w*2,this.y,n.x,n.y-n.h/2),u.drawLeftOrRightToTop(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x-this.l*2,this.y,n.x,n.y-n.l),u.drawLeftOrRightToTop(t,i))};this.drawLeftToLeft=function(n,i){var u;n=r(n);n.flag=="step"?(u=new FlowArrow(this.x-this.w*2,this.y,n.x+this.w/2,n.y),u.drawLeftToRightOrRightToLeft(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x-this.l*2,this.y,n.x+this.l*2,n.y),u.drawLeftToRightOrRightToLeft(t,i))};this.drawLeftToRight=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.w/2:this.l*2;i=i||{};i.offsetX=this.flag==="step"?0:100;n.flag=="step"?(u=new FlowArrow(this.x-f,this.y,n.x+this.w/2,n.y),u.drawLeftToRightOrRightToLeft(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x-f,this.y,n.x+this.l*2,n.y),u.drawLeftToRightOrRightToLeft(t,i))};this.drawRightToTop=function(n,i){var u;n=r(n);n.flag=="step"?(u=new FlowArrow(this.x+this.w*2,this.y,n.x,n.y-n.h/2),u.drawLeftOrRightToTop(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x+this.l*2,this.y,n.x,n.y-n.l),u.drawLeftOrRightToTop(t,i))};this.drawRightToLeft=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.w/2:this.l*2;n.flag=="step"?(u=new FlowArrow(this.x+f,this.y,n.x-this.w/2,n.y),u.drawLeftToRightOrRightToLeft(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x+f,this.y,n.x-this.l*2,n.y),u.drawLeftToRightOrRightToLeft(t,i))};this.drawRightToRight=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.w/2:this.l*2;i=i||{};i.offsetX=50;n.flag=="step"?(u=new FlowArrow(this.x+f,this.y,n.x+this.w/2,n.y),u.drawRightToLeftOrLeftToRight(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x+f,this.y,n.x+this.l*2,n.y),u.drawRightToLeftOrLeftToRight(t,i))}}function FlowChart(n,t){var i=this;this.option=t;this.steps=[];this.render=function(r){var h=t.width||1200,c=t.height||800,l=t.font||"normal 14px YaHei",e,o,s,u,f;for($('<canvas id="'+n+'" width="'+h+'" height="'+c+'">').appendTo(r),e=document.getElementById(n),o=e.getContext("2d"),o.font=l,u=0;u<t.items.length;u++)f=t.items[u],s=new FlowStep(i,o,f),i.steps.push(s);for(u=0;u<t.items.length;u++)f=t.items[u],f.arrow&&f.arrow({step:i.steps[u]});t.click&&(e.onclick=function(n){var r,u;n=n||window.event;var o=n.offsetX,s=n.offsetY,f="",e=null;for(r=0;r<i.steps.length;r++)if(u=i.steps[r],u.contains(o,s)){f=u.name;e=u;break}t.click({name:f,chart:i,step:e})})}}function ListBox(n,t){function s(){u.length||(u=$('<ul class="list-body">').appendTo(r));i.data?e(i.data):i.url&&c&&h()}function e(n){var r,o,e,t,s;if(u.html(""),_this.selected=null,r=Utils.getCodes(n),o="item",r&&r.length)for(e=0;e<r.length;e++){t=r[e];s=t.Name||t.Code||t;$('<li class="list-item">').html(s).data(o,t.Data||t).appendTo(u).on("click",function(){if($(".list-item").removeClass("active"),f=$(this).index("li"),_this.selected=$(this).addClass("active").data(o),i.onClick)i.onClick(_this.selected)})}}function h(){i.url&&$.get(i.url,function(n){e(n)})}var r=typeof n=="string"?$("#"+n):n,o=typeof n=="string"?n:n.attr("id"),c=t.autoLoad===undefined?!0:t.autoLoad,i=t||{},u=r.find(".list-body"),f=0;_this=this;this.id=o;this.selected=null;this.render=function(){return r=$('<div class="list">').attr("id",o),s(),r};this.select=function(n){f=n;u.find("li:eq("+n+")").click()};this.reload=function(){h();this.select(f)};this.setData=function(n){e(n)};r.length&&s()}function Query(n){function e(){t.id&&i.attr("id",t.id);t.isTradition||i.addClass("left");t.querys&&t.querys.length&&s(t.querys);u.elem=i}function s(n){var f,h,a,e,y,l,s,c,p;for(i.html(""),c=0;c<n.length;c++)if(f=n[c],f.visible===undefined||f.visible)if(h=$('<div class="query-item">').appendTo(i),a=$("<label>").html(f.title).appendTo(h),f.labelWidth&&a.css({width:f.labelWidth}),f.form=u,f.width="",f.inputStyle="",f.type=f.type||"text",f.isQuery=!0,f.type==="textarea"&&(f.type="text"),f.code&&(f.type="select"),e=new Date,f.type==="dateRange"){var w=new Date(e.getFullYear(),e.getMonth(),e.getDate()-(f.diffDay||7)),b=f.prefixType==="LG"?"L":"start",v=new Input(h,$.extend({},f,{type:"date",field:b+f.field,placeholder:"yyyy-MM-dd"}));r(v);v.elem.fdatepicker({format:"yyyy-mm-dd",initialDate:w.format("yyyy-MM-dd"),endDate:e});$("<span>~<\/span>").appendTo(h);y=f.prefixType==="LG"?"G":"end";l=new Input(h,$.extend({},f,{type:"date",field:y+f.field,placeholder:"yyyy-MM-dd"}));r(l);l.elem.fdatepicker({format:"yyyy-mm-dd",initialDate:e.format("yyyy-MM-dd"),endDate:e})}else f.type==="dateMonth"?(s=new Input(h,$.extend({},f,{type:"date",placeholder:"yyyy-MM"})),r(s),s.elem.fdatepicker({format:"yyyy-mm",startView:"year",minView:"year",maxView:"year",initialDate:e.format("yyyy-MM"),endDate:e.format("yyyy-MM")})):f.type==="date"?(s=new Input(h,$.extend({},f,{type:"date",placeholder:"yyyy-MM-dd"})),r(s),s.elem.fdatepicker({format:"yyyy-mm-dd",initialDate:e.format("yyyy-MM-dd"),endDate:e})):f.type==="picker"?(s=new Input(h,{type:"text",field:f.field}),r(s)):(s=new Input(h,f),r(s));if(Utils.createButton({style:"primary",icon:"fa fa-search",text:Language.Search,handler:function(){o()}}).appendTo(i),t.buttons&&t.buttons.length)for(c=0;c<t.buttons.length;c++)p=t.buttons[c],Utils.createButton(p,function(){var n=u.getData();return{grid:t.grid,data:n}}).appendTo(i)}function r(n){n.setReadonly(!1);f.push(n);u[n.name]=n}function o(){var n=u.getData();if(t.onSearch)t.onSearch({grid:t.grid,data:n});else t.grid.reload(n,0)}var t=n,i=$('<div class="query">'),f=[],u=this;(n.autoRender===undefined||n.autoRender)&&e();this.elem=i;this.render=function(){return e(),i};this.getData=function(){for(var t,i={},n=0;n<f.length;n++)t=f[n],i[t.name]=t.getValue();return i};this.search=function(){o()}}function Router(n,t){var u=t||{},i=n,r={},f=this;this.elem=i;this.route=function(n){var f=r.component,t;f&&f.destroy&&f.destroy();u.isTop&&(n.previous||(n.previous=r),r=n);t=n.component;t&&(typeof t=="string"?i.html()===""&&i.html(t):(i.html(""),u.multiNode?t.render(i):t.render().appendTo(i)),setTimeout(function(){Page.complete();t.mounted&&t.mounted()},10))};this.back=function(){f.route(r.previous)}}function Tabs(n){function c(){i=$('<div class="tabs">');r=$('<div class="tabs-header">').appendTo(i);t.showTitle&&(u=$('<div class="tabs-title">').appendTo(r));f=$("<ul>").appendTo(r);t.showClose&&$('<i class="fa fa-close close">').appendTo(r).click(function(){i.hide();t.onClose&&t.onClose()});e=$('<div class="tabs-body">').appendTo(i);t.fit&&i.addClass("tabs-fit");t.style&&i.addClass(t.style);t.singleTab&&(o=new Router(e,{}));t.items&&l(t.items)}function l(n){for(var i,r,t=0;t<n.length;t++)i=n[t],i.index=t,r=$("<li>").append(i.name).appendTo(f).data("item",i).on("click",function(){var n=$(this).data("item");h($(this),n)});h(f.find("li:eq(0)"),n[0])}function h(n,i){if(f.find("li").removeClass("active"),n.addClass("active"),t.singleTab)o.route(i);else{var s=i.index||0,u="tab-"+s,r=$("#"+u);r.length||(r=$('<div class="tabs-item">').attr("id",u).appendTo(e),new Router(r,{}).route(i));$(".tabs-item",e).removeClass("active");r.addClass("active")}t.onItemClick&&t.onItemClick(i)}var t=n||{},i,r,u,f,e,o,a=this,s;this.option=t;this.render=function(){return c(),i};this.show=function(r){var f,o,c,h,e;s=!0;r=r||{Id:""};t.showTitle&&(f=t.title,f||(o=getCurTab(),f=o?o.title:""),u.html(""),c=n.icon||"fa fa-window-maximize",u.append('<i class="'+c+'">').append(f),h=r.Id===""?"【"+Language.New+"】":"【"+Language.Edit+"】",e="",t.titleInfo&&(e=t.titleInfo(r)),e.indexOf("【")>-1&&(h=""),u.append(h+e));i.show()};this.close=function(){s&&i.hide()}}function Toolbar(n){function e(r){var h,e,c,l,a;for(t.id&&i.attr("id",t.id),t.isTradition||i.addClass("right"),t.query&&o(i,t.query),h=0;h<t.buttons.length;h++)(e=t.buttons[h],typeof e=="string"&&(e=f[e]),c=e.target.indexOf("toolbar")>=0,l=e.target.indexOf("batch")>=0,n.isGridCell||n.isTradition||c||l)&&(e.children&&e.children.length?s(i,e):u(r||i,e));t.toolbarTips&&(a=$('<div class="toolbar-tips">').appendTo(i),$(t.toolbarTips).appendTo(a))}function o(n,t){Utils.createButton({icon:"fa fa-search",text:Language.Query,handler:function(){t&&t()}}).appendTo(n)}function s(n,t){var i=$('<div class="dropdown">').appendTo(n),r;$('<div class="title">').append('<i class="'+t.icon+'">').append("<span>"+t.name+"<\/span>").append('<i class="fa fa-caret-down arrow">').appendTo(i);r=$('<dl class="child">').appendTo(i);t.children.forEach(function(n){u(r,n,"<dd>")})}function u(n,i,u){u||(u=t.isGridCell?t.onlyIcon?"<i>":"<span>":t.onlyIcon?"<i>":"<button>");var f=$(u).data("item",i).on("click",function(){var n=$(this).data("item"),i=t.gridParameter?t.gridParameter():null;n.handler?n.handler.call(this,i):r[n.code]&&r[n.code].call(this,i)}).appendTo(n);t.onlyIcon?f.addClass(i.icon).attr("title",i.name):t.isGridCell?f.append(i.name):f.append('<i class="'+i.icon+'">').append("<span>"+i.name+"<\/span>")}var t=n,i=$('<div class="toolbar">'),r=n.toolbar||{},f={add:{code:"add",name:Language.New,icon:"fa fa-plus",target:"toolbar"},edit:{code:"edit",name:Language.Edit,icon:"fa fa-edit",target:"grid"},remove:{code:"remove",name:Language.Delete,icon:"fa fa-trash-o",target:"grid,batch"},"import":{code:"import",name:Language.Import,icon:"fa fa-sign-in",target:"toolbar"},"export":{code:"export",name:Language.Export,icon:"fa fa-sign-out",target:"toolbar"}};this.elem=i;this.render=function(n){return e(n),i}}function Tree(n,t){function s(){i.addClass("ztree");t.data&&e(t.data);t.url&&l&&h(!1)}function h(n){t.url&&$.get(t.url,function(i){var u,o;if(n)for(u=0;u<i.length;u++)o=f.indexOf(i[u].id),o>-1&&(i[u].open=!0);e(i);t.onLoad&&t.onLoad(r.data)})}function e(n){var e={view:{nodeClasses:function(n,t){return{add:["tree-"+(t.type||"type")]}}},data:{key:{url:""}},callback:{onClick:function(n,i,u){r.selectedNode=u;t.onClick&&t.onClick(u)},onExpand:function(n,t,i){f.push(i.id)},onCollapse:function(n,t,i){var r=f.indexOf(i.id);r>-1&&f.splice(r,1)}}};t.check&&(e.check={enable:!0,chkboxType:{Y:"ps",N:"s"}});c&&(e.data.simpleData={enable:!0,pIdKey:t.parentKey||"pid"});u=$.fn.zTree.init(i,e,n);t.expandAll&&u.expandAll(!0);r.list=n;r.data=u.getNodes()}$.fn.zTree||(Utils.addCss(baseUrl+"/static/libs/ztree/ztree.css"),Utils.addJs(baseUrl+"/static/libs/ztree/jquery.ztree.min.js"));var c=t.simpleData===undefined?!0:t.simpleData,l=t.autoLoad===undefined?!0:t.autoLoad,i=typeof n=="string"?$("#"+n):n,o=typeof n=="string"?n:n.attr("id"),r=this,u,f=[];i.length&&s();this.id=o;this.list=[];this.data=[];this.selectedNode=null;this.render=function(){return i=$("<ul>").attr("id",o),s(),i};this.setData=function(n){e(n)};this.reload=function(){h(!0)};this.getCheckedNodes=function(){return u.getCheckedNodes(!0)};this.getNodeData=function(n){var t=this.list.filter(n);return t.length?t[0].data:null}}function View(n,t){function h(){var t=top.ExtForm[n],i,r;if(t){if(i=t.columns,i&&i.length)for(r=0;r<i.length;r++)u.push(i[r]);t.formOption&&$.extend(!0,o,t.formOption);t.gridOption&&$.extend(!0,f,t.gridOption)}}function c(){var f=$.extend(!0,{card:!0,fields:u.slice(),toolbar:[{text:Language.Save,icon:"fa fa-save",handler:function(n){n.form.save(t.url.SaveModel,e)}}]},o),i;if(t.formToolbar)for(i=0;i<t.formToolbar.length;i++)f.toolbar.push(t.formToolbar[i]);r=new Form(n,f)}function l(){var s=[],o,h;f.toolButtons||(o=getCurTab(),o&&o.children&&(s=o.children.filter(function(n){return n.type==="button"})));h=$.extend(!0,{form:r,isTradition:!1,isIconButton:!1,url:t.url.QueryModels||"",autoQuery:!1,toolButtons:s,toolbar:{add:function(n){var t=r.option.data;typeof t=="function"&&(t=t());n.addRow(t)},edit:function(n){n.editRow()},remove:function(n){n.deleteRows(t.url.DeleteModels,e)},up:function(n){n.moveRow("up",t.url.MoveModel)},down:function(n){n.moveRow("down",t.url.MoveModel)},"import":function(n){n.import(t.url.ImportModels)},"export":function(n){n.export()}},columns:u.slice().filter(function(n){return!n.onlyForm&&n.type!=="hidden"})},f);i=new Grid(n,h)}var s=this,e=t.refresh||function(){s.load()},u=t.columns||[],r,o=t.formOption||{},i,f=t.gridOption||{};u.filter(function(n){return n.type}).length&&(h(),c());l();this.name=n;this.option=t;this.form=r;this.grid=i;this.render=function(){var n=$('<div class="fit">'),u,f;return t.left?(f=$('<div class="fit-col-3">').appendTo(n),u=$('<div class="fit-col-7">').appendTo(n),t.left.render().appendTo(f)):u=t.inner?n:$('<div class="fit-col">').appendTo(n),i.render().appendTo(u),r&&r.render().appendTo($("body")),n};this.load=function(n){t.left?(t.left.reload(n),i.setData([])):i.reload(n)};this.loadGrid=function(n){i.reload(n)};this.getGridData=function(){return i.getData()};this.setGridData=function(n){i.setData(n)};this.setGridDetail=function(n){i.setDetail(n)};this.getRowData=function(n){var t=i.data.filter(n);return t.length?t.length===1?t[0]:t:null}}function getCurTab(){return top.Admin.currentTab}function showTabPage(n){top.Admin.showPage(n)}function showTabPageByCode(n){var t=top.Admin.menuList.filter(function(t){return t.code===n});t.length&&top.Admin.showPage(t[0])}function App(n,t){function u(){i=new Router(r,{isTop:!0,multiNode:!0})}var r=$("#"+n),f=t,i;u();this.elem=r;this.router=i;this.user={};this.route=function(n){i.route(n)};this.render=function(){var n=Utils.getUrlParam("m");Page[n]?(i.route(Page[n]),setTimeout(function(){Page.complete();BizHistory.init()},10)):r.html('<div class="content">'+n+Language.NotExist+"！<\/div>")}}var baseUrl=$("base").attr("href"),baseApiUrl,Layer,app;baseUrl=baseUrl.substring(0,baseUrl.length-1);baseApiUrl=baseUrl;Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};var Utils={getUrlParam:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t==null?null:decodeURI(t[2])},addCss:function(n,t){var r=document.createElement("link"),i;r.rel="stylesheet";r.href=n;i=$('link[href*="static/libs/"]');(!i.length||t)&&(i=$('link[href*="static/"]'));i.last().after($(r))},addJs:function(n,t){var r=document.createElement("script"),i;r.src=n;i=$('script[src*="static/libs/"]');(!i.length||t)&&(i=$('script[src*="static/"]'));i.last().after($(r))},loadJs:function(n){window.onload=function(){var t=document.createElement("script");t.src=n;document.body.appendChild(t)}},format:function(n,t){return arguments.length==1?function(){var t=$.makeArray(arguments);return t.unshift(n),$.format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),i)}),n)},copy:function(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="absolute";t.style.left="-9999px";document.body.appendChild(t);i=document.getSelection();r=i.rangeCount>0?i.getRangeAt(0):!1;t.select();document.execCommand("copy");document.body.removeChild(t);r&&(i.removeAllRanges(),i.addRange(r))},paste:function(n,t){n?$(document).bind("paste",function(){if(event.clipboardData||event.originalEvent){var n=event.clipboardData||window.clipboardData,i=n.getData("text");t&&t(i);event.preventDefault()}}):$(document).unbind("paste")},list2Tree:function(n,t){if(!n)return[];let i=n.slice();return i.filter(function(n){let r=i.filter(function(t){return n.id===t.pid});return r.length>0&&(n.children=r),n.pid===t})},tree2List:function(n){if(!n)return[];let i=[],t=n.slice();while(t.length){let r=t.shift();i.push(r);let n=r.children;if(n&&n.length)for(let i=0;i<n.length;i++)t.push(n[i])}return i},getExtIcon:function(n){switch(n){case".pdf":return"fa fa-file-pdf-o pdf";case".doc":case".docx":return"fa fa-file-word-o doc";case".xls":case".xlsx":return"fa fa-file-excel-o xls";case".ppt":case".pptx":return"fa fa-file-powerpoint-o ppt";case".jpg":case".jpeg":case".gif":case".png":case".tif":return"fa fa-file-photo-o";case".rar":case".zip":case".gz":return"fa fa-file-zip-o";default:return"fa fa-file-o"}},setUser:function(n){n?sessionStorage.setItem("Known_User",JSON.stringify(n)):sessionStorage.removeItem("Known_User")},getUser:function(){var n=sessionStorage.getItem("Known_User");return!n||n==="undefined"?null:JSON.parse(n)},setCodes:function(n){n?localStorage.setItem("Known_Codes",JSON.stringify(n)):localStorage.removeItem("Known_Codes")},getCodes:function(n){var i,t,r,u;if(!n)return[];if($.isArray(n))return n;if($.isPlainObject(n)){i=[];for(t in n)i.push({Code:t,Name:t,Data:n[t]});return i}return n==="YesNo"?[{Code:1,Name:Language.Yes},{Code:0,Name:Language.No}]:n==="HasNot"?[{Code:1,Name:Language.Has},{Code:0,Name:Language.Not}]:n==="Enabled"?[{Code:1,Name:Language.Enable},{Code:0,Name:Language.Disable}]:(r=localStorage.getItem("Known_Codes"),!r)?[]:(u=JSON.parse(r),!u)?[]:u[n]||[]},getCodeName:function(n,t){var r=this.getCodes(n),f,e,u,i;if(r&&r.length){if(typeof t=="string"&&t.indexOf(",")>0){for(f=t.split(","),e=[],u=0;u<f.length;u++)i=r.filter(function(n){return n.Code===f[u]}),i.length&&e.push(i[0].Name||t);return e.join(",")}if(i=r.filter(function(n){return n.Code===t}),i.length)return i[0].Name||t}return t},getCodeObject:function(n,t){var f={},i=this.getCodes(n),r,u;if(i&&i.length)for(r=0;r<i.length;r++)u=i[r],t&&t.push(u.Name),f[u.Code]=u.Name;return f},genFile:function(n,t){function e(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}var u=new Blob([e(n)],{type:"application/octet-stream"}),f=URL.createObjectURL(u),r=document.createElement("a"),i;r.href=f;r.download=t||"";window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));r.dispatchEvent(i)},checkMobile:function(){for(var r=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,n=0;n<t.length;n++)if(r.indexOf(t[n])>0){i=!0;break}return i},printIframe:null,print:function(n){var t=this.printIframe,i;this.printIframe||(t=this.printIframe=document.createElement("iframe"),document.body.appendChild(t),t.style.display="none");n.url?(t.src=n.url,n.ajax||(t.onload=function(){setTimeout(function(){t.contentWindow.print()},1)})):n.html&&(i=t.contentWindow.document,i.open(),i.write("<title>"+n.title+"<\/title>"),$(document).find("link").filter(function(){return $(this).attr("rel").toLowerCase()==="stylesheet"}).each(function(){i.write('<link rel="stylesheet" href="'+$(this).attr("href")+'">')}),i.write("<style>html,body{overflow:auto;height:auto;}.form-table{padding:0;}<\/style>"),setTimeout(function(){typeof n.html=="function"?i.write(n.html()):i.write(n.html);setTimeout(function(){t.contentWindow.print()},1)},100))},initPCAField:function(n){var t,i;window.PCARegion||this.addJs(baseUrl+"/static/libs/region.js");n.form.Province.setData(window.PCARegion,n.data.Province);n.form.Province.change(function(n){n.form.City.setData(n.selected.Data);n.form.Area.setData([])});n.form.City.change(function(n){n.form.Area.setData(n.selected.Data)});n.data.Province&&(t=n.form.Province.getData()||{},n.form.City.setData(t.Data,n.data.City));n.data.City&&(i=n.form.City.getData()||{},n.form.Area.setData(i.Data,n.data.Area))},createButton:function(n,t){var i=$("<button>").data("item",n);n.icon&&i.append('<i class="'+n.icon+'">');n.style&&i.addClass(n.style);i.append("<span>"+(n.text||n.name)+"<\/span>").on("click",function(){var n=$(this).data("item"),i;n.handler&&(t&&$.isFunction(t)&&(t=t()),i=$.extend({item:n},t),n.handler.call(this,i))});return i}},Ajax={get:function(n,t,i){var r=Layer.loading(Language.Loading+"......");$.get(n,t,function(n){r.close();n.message&&Layer.tips(n.message);n.ok?i&&i(n.data):i&&i(n)})},post:function(n,t,i){var r=Layer.loading(Language.Submitting+"......");$.post(n,t,function(n){r.close();n.ok?(Layer.tips(n.message),i&&i(n.data)):n.message?Layer.alert(n.message):i&&i(n)})},upload:function(n,t,i,r){for(var s=Layer.loading(Language.Uploading+"......"),e=new FormData,u=new XMLHttpRequest,o=document.getElementById(n).files,f=0;f<o.length;f++)e.append("file"+f,o[f],o[f].name);i&&e.append("data",JSON.stringify(i));u.onload=function(){s.close();var n=JSON.parse(u.responseText);n.ok?(Layer.tips(n.message),r&&r(n.data)):n.message?Layer.alert(n.message):r&&r(n)};u.upload.onprogress=function(n){var t=n.loaded,i=n.total};u.open("post",t,!0);u.send(e)},download:function(n,t,i){function o(n){var i=new RegExp("(^| )"+n+"=([^;]*)(;|$)"),t=document.cookie.match(i);return t&&t.length>3?unescape(t[2]):null}function s(){var n=Layer.loading(Language.Downloading+"......"),t=window.setInterval(function(){var r=o(f);r===e&&(window.clearInterval(t),n.close(),i&&i())},1e3)}var f="downloadToken",e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),r=$('<form method="post" action="'+n+'" target="" style="display:none">').appendTo("body"),u;if($('<input type="hidden">').attr("name",f).attr("value",e).appendTo(r),t&&t!==null)for(u in t)$('<input type="hidden">').attr("name",u).attr("value",t[u]).appendTo(r);r.submit();s()}},WsUtil={ws:null,isClosed:!1,connect:function(n,t,i){var r=this;return r.log(Language.Connecting+"......"),r.ws=new WebSocket(n),r.ws.onopen=function(){r.log(Language.ClientConnected);t&&r.send(JSON.stringify(t))},r.ws.onmessage=function(n){n.data&&i&&i(n.data)},r.ws.onclose=function(){r.isClosed||(r.log(Language.ClientDisconnected),r.connect(n,t,i))},r.ws.onerror=function(n){r.log(n);r.close()},window.onbeforeunload=function(){r.close()},r.ws},send:function(n){this.ws&&this.ws.send(n)},close:function(){this.isClosed=!0;this.ws&&(this.ws.close(),this.ws=null,this.log(Language.ClientClosed))},log:function(n){console.log(n)}},Page={complete:function(){initDropdown();$(".tabs-header li").click(function(){var n=$(this).parent().parent(),t=$(this).index();n.find(".tabs-header li").removeClass("active");n.find(".tabs-item").removeClass("active");$(this).addClass("active");n.find(".tabs-item:eq("+t+")").addClass("active")});$('[placeholder="yyyy-MM-dd"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd"})});$('[placeholder="yyyy-MM-dd HH:mm"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd hh:ii",pickTime:!0})});$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})}},curUser=Utils.getUser();$(document).ajaxSend(function(n,t){t.setRequestHeader("token",curUser?curUser.Token:"")});$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&(i.timeout?top.location=baseUrl+"/login":i.error&&(top.location=baseUrl+"/error?t="+i.type))}});$(function(){initDropdown()});Layer={index:1e5,page:function(n){return this._show("page",n)},open:function(n){return n.showMax=n.showMax===undefined?!0:n.showMax,this._show("dialog",n)},loading:function(n){var i,e;if(n=n||"",n==="")return{close:function(){}};var r=this,t=r.index++,u="mask"+t,f="load"+t;return $('<div class="mask">').attr("id",u).css({zIndex:t}).appendTo($("body")),i=$('<div class="loading">').attr("id",f).append('<i class="fa fa-spinner">').append(n),e=i.outerWidth(),i.css({marginLeft:-(e/2)+"px",zIndex:t+1}).appendTo($("body")),{close:function(){$("#"+u+",#"+f).remove();r.index--}}},tips:function(n){var t,i,r;(n=n||"",n!=="")&&(t=$(".tips"),t.length||(t=$('<div class="tips">').css({zIndex:this.index}).appendTo($("body"))),t.html(n),i=t.outerWidth(),r=t.outerHeight(),t.css({marginLeft:-(i/2)+"px",marginTop:-(r/2)+"px"}),setTimeout(function(){t.remove()},3e3))},alert:function(n,t){var i=this._show("dialog",{showMax:!1,icon:"fa fa-info-circle",title:Language.Tips,width:300,height:150,content:'<div style="text-align:center;height:56px"><div style="padding-top:15px;">'+n+"<\/div><\/div>",footer:'<button class="ok">'+Language.OK+"<\/button>"});i.layer.find(".dialog-footer .ok").click(function(){t&&t();i.close()})},confirm:function(n,t){var i=this._show("dialog",{showMax:!1,icon:"fa fa-question-circle",title:Language.Confirm,width:300,height:150,content:'<div style="text-align:center;height:56px"><div style="padding-top:15px;">'+n+"<\/div><\/div>",footer:'<button class="ok">'+Language.OK+'<\/button><span style="width:20px;display:inline-block;"><\/span><button class="cancel">'+Language.Cancel+"<\/button>"});i.layer.find(".dialog-footer .ok").click(function(){t&&t();i.close()});i.layer.find(".dialog-footer .cancel").click(function(){i.close()})},_show:function(n,t){function b(n){$('<i class="fa fa-window-maximize maximize">').data("isMax",!1).appendTo(n).click(function(){$(this).data("isMax")?($(this).data("isMax",!1).removeClass("fa-window-restore").addClass("fa-window-maximize"),i.removeClass("dialog-max").attr("style",$(this).data("layerStyle"))):($(this).data("isMax",!0).data("layerStyle",i.attr("style")).removeClass("fa-window-maximize").addClass("fa-window-restore"),i.addClass("dialog-max").attr("style","").css({zIndex:u+1}))})}function h(n){$('<i class="fa fa-close close">').appendTo(n).click(function(){e.close();t.onClose&&t.onClose()})}function k(n){n.mousedown(function(n){n.preventDefault();r.move=!0;r.offset=[n.clientX-parseFloat(i.css("left")),n.clientY-parseFloat(i.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),r.move){var t=n.clientX-r.offset[0],u=n.clientY-r.offset[1];i.css({left:t,top:u})}}).mouseup(function(){delete r.move})}function p(n,i){if(t.content)i&&n.css({overflow:"auto"}),typeof t.content=="function"?t.content(n):n.append(t.content);else if(t.url)t.partial?(i&&n.css({overflow:"auto"}),n.load(t.url)):(i||n.css({padding:0,overflow:"hidden"}),$('<iframe frameborder="0">').attr("src",t.url).appendTo(n));else if(t.component){var r=new Router(n);r.route(t)}}function d(n){if(t.footer)$('<div class="dialog-footer">').html(t.footer).appendTo(n);else if(t.buttons){var i=$('<div class="dialog-footer">').appendTo(n);$(t.buttons).each(function(n,t){$('<button class="ok">').append(t.text).on("click",function(){t.handler&&t.handler.call(this,e)}).appendTo(i)});$('<button class="cancel">'+Language.Cancel+"<\/button>").on("click",function(){e.close();t.onClose&&t.onClose()}).appendTo(i)}else s.css({bottom:0})}var a=this,u=a.index++,v="mask"+u,y="layer"+u,i,e,r,c,l,w,o,s,f;return $('<div class="mask">').attr("id",v).css({zIndex:u}).appendTo($("body")),i=$("<div>").attr("id",y).addClass(n).css({zIndex:u+1}).appendTo($("body")),e={index:u,layer:i,close:function(){$("#"+v+",#"+y).remove();a.index--}},r={},n==="dialog"?(c=t.width||500,l=t.height||300,i.css({width:c+"px",height:l+"px",marginTop:-(l/2)+"px",marginLeft:-(c/2)+"px"}),f=$('<div class="dialog-content">').appendTo(i),t.title?(w=t.icon||"fa fa-window-maximize",o=$('<div class="dialog-header">').append('<i class="icon '+w+'">').append(t.title),k(o),t.showMax&&b(o),h(o),f.append(o)):t.showClose&&h(i),s=$('<div class="dialog-body">').appendTo(f),t.title||s.css({top:0}),p(s,!1),d(f)):(f=$('<div class="page-content">').appendTo(i),h(i),p(f,!0)),t.success&&t.success(),e}};Form.bind=function(n,t,i){var f,u,r,e,o,s;for(f in t)u=n.find('[name="'+f+'"]'),u.length&&(r=t[f],e=u.attr("placeholder"),e&&(o=r instanceof Date?r:new Date(r),r=o.format(e)),s=u[0].nodeName,"DIV,P,SPAN,TD".indexOf(s)>-1?u.html(r):u.val(r),i&&i({elem:u,value:r,data:t}))};Picker.action={};GridManager.isLoad=!1;Chart.isLoad=!1;app=new App("app",{});$(document).contextmenu(function(n){n.preventDefault()});$(function(){Page.complete()});