function log(n){console.log(n)}function initDropdown(){$(".dropdown .title").on("mouseenter",function(){$(this).find(".arrow").removeClass("fa-caret-down").addClass("fa-caret-up");$(this).next().show()});$(".dropdown").on("mouseleave",function(){var n=$(this).find(".title");n.find(".arrow").removeClass("fa-caret-up").addClass("fa-caret-down");n.next().hide()})}function Chart(n){Chart.isLoad||(Utils.addJs(baseUrl+"/static/libs/echarts.min.js"),Chart.isLoad=!0);var t=echarts.init(document.getElementById(n));this.clear=function(){t.clear()};this.setOption=function(n){t.setOption(n)};this.setLine=function(n){t.setOption(n)};this.setPie=function(n){t.setOption(n)}}function Form(n,t){function o(){if(e={},r=[],i.fields&&l(i.fields),i.toolbar&&i.toolbar.length){var n=$('<div class="form-button">').appendTo(u.parent());c(n)}}function c(n){for(var r,t=0;t<i.toolbar.length;t++)r=i.toolbar[t],n.append(Utils.createButton(r,{form:f}))}function l(n){var r,t,i,f;for(u.html(""),r=0;r<n.length;r++)(t=n[r],t.visible===undefined||t.visible)&&(t.type==="hidden"?(f=new Input(u,t),h(f)):(t.label?e[t.label]?i=e[t.label]:(i=s(u,t),e[t.label]=i):i=s(u,t),f=new Input(i,t),h(f)))}function s(n,t){var u=t.label||t.title,i=$('<div class="form-item">').appendTo(n),r=$('<label class="form-label">').html(u+"：").appendTo(i),f=$('<div class="form-input">').appendTo(i);return t.required&&r.addClass("required"),t.labelWidth&&r.css({width:t.labelWidth}),f}function h(n){r.push(n);f[n.id]=n}var i=t,u=typeof n=="string"?$('<div id="form'+n+'" class="form">'):n,e={},r=[],f=this;n.length&&o();this.elem=u;this.render=function(){return o(),u};this.validate=function(){for(var t,i=[],n=0;n<r.length;n++)t=r[n],t.validate()||i.push(t);return i.length===0};this.clear=function(){for(var t,n=0;n<r.length;n++)t=r[n],t.clearError(),t.setValue("")};this.getData=function(){for(var t,i={},n=0;n<r.length;n++)t=r[n],i[t.id]=t.getValue();return i};this.setData=function(n){for(var u,e,o,t=0;t<r.length;t++)u=r[t],e=n[u.id],u.setValue(e);o={form:f,data:n};i.setData&&i.setData(o)};this.save=function(n,t){var r,u,e;f.validate()&&(r=f.getData(),i.onSaving&&i.onSaving(r),u={data:JSON.stringify(r)},i.submitData&&(e=i.submitData(),$.extend(u,e)),Ajax.post(n,u,function(n){r.Id=n;f.setData(r);t&&t(r)}))}}function Grid(n){function v(){t.querys&&t.querys.length&&(e=y(t));var n=$("<table>").appendTo(i);o=$("<thead>").appendTo(n);t.columns&&t.columns.length&&a(t.columns);u=$("<tbody>").appendTo(n);t.url&&t.autoQuery===undefined&&l()}function l(){h(Language.Loading+"......","load");$.get(t.url,f.where,function(n){var i=[];$.isArray(n)?i=n:n.ok?i=n.data:h(n.message,"error");t.setData?(s=i,t.setData({grid:f,data:i})):f.setData(i)})}function y(n){var r=$('<div class="query">').appendTo(i),t=new Query(n);return t.render().appendTo(r),t}function a(n){var u,t,i;for(o.html(""),u=$("<tr>").appendTo(o),r=n,c=n.length,t=0;t<n.length;t++)(i=n[t],i.visible===undefined||i.visible)&&$("<th>").html(i.title).appendTo(u)}function p(n){if(s=n,u.html(""),n&&n.length)for(var t=0;t<n.length;t++)w(n[t]);else h(Language.NoDataFound,"error")}function w(n){for(var t,i,o,s,e=$("<tr>").appendTo(u),f=0;f<r.length;f++)(t=r[f],t.visible===undefined||t.visible)&&(i=$("<td>").appendTo(e),t.format?(o=t.format(n,{tr:e,td:i,column:t}),i.append(o)):t.field&&(s=n[t.field],i.append(s)))}function h(n,t){u.html('<tr><td colspan="'+c+'" class="'+t+'">'+n+"<\/td><\/tr>")}var t=n,i=$('<div class="grid">'),r=[],c=0,e,o,u,s=[],f=this;this.elem=i;this.columns=r;this.where=t.where||{};this.render=function(){return i.html(""),v(),i};this.setColumns=function(n){a(n)};this.getData=function(){return s};this.setData=function(n){p(n)};this.reload=function(n){var t=e?e.getData():{};$.extend(f.where,t,n||{});l()}}function Input(n,t){function c(){o=i.id||i.field;s=i.field;var t=i.type;t==="label"?r=$('<div class="label">').appendTo(n):t==="radio"?e(n,i,i.code):t==="checkbox"?e(n,i,i.code):(t==="select"?(r=$("<select>").appendTo(n),e(r,i,i.code)):t==="textarea"?r=$("<textarea>").appendTo(n):(r=$('<input type="'+t+'">').appendTo(n),i.value&&r.attr("value",i.value)),r.attr("id",o),r.attr("name",s),i.placeholder&&r.attr("placeholder",i.placeholder),i.required&&r.attr("required",!0),i.width&&r.css({width:i.width}),i.change&&r.change(function(){var n=$(this);i.change({elem:n,value:n.val(),selected:n.find(":selected").data("data")})}));i.readonly&&h(!0)}function h(n){i.type==="radio"||i.type==="checkbox"?u.find("input").attr("disabled",n):i.type==="select"?r.attr("disabled",n):r.attr("readonly",n)}function l(n,t){$.get(n,function(n){f.setData(n);t&&t(n)})}function e(n,t,i){var u,f,r,i,e,o;if((n.html(""),i)&&(i=Utils.getCodes(i),i&&i.length)){for(u=[],t.type==="select"&&(f="",f=t.emptyText!==undefined?t.emptyText:Language.PleaseSelect,f!==""&&u.push({Code:"",Name:f})),r=0;r<i.length;r++)u.push(i[r]);for(r=0;r<u.length;r++)i=u[r],i==="-"?$("<br>").appendTo(n):(e=i.Code===""?"":i.Code||i,o=i.Name||e,t.type==="select"?a(n,u[r],e,o,t.value):v(n,u[r],e,o,t))}}function a(n,t,i,r,u){var f=$("<option>").data("data",t).attr("value",i).html(r).appendTo(n);u&&i===u&&f.attr("selected",!0)}function v(n,t,i,r,u){var f=$('<label class="form-radio">').appendTo(n),e=$("<input>").data("data",t).attr("type",u.type).attr("name",u.field).attr("value",i).appendTo(f),o=u.value;if(o&&i===o&&e.attr("checked",!0),u.onClick)e.on("click",function(){u.onClick($(this).val())});$("<span>").html(r).appendTo(f)}var u=n,i=t,r,o,s,f=this;c();this.elem=r;this.id=o;this.name=s;this.value="";this.validate=function(){f.clearError();var n=$.trim(f.getValue());return r&&!r[0].disabled&&i.required&&n===""?(u.addClass("error"),!1):i.required&&n===""?(u.addClass("error"),!1):!0};this.clearError=function(){u.removeClass("error")};this.getValue=function(){if(i.type==="label")return f.value;if(i.type==="radio")return u.find("input:checked").val()||"";if(i.type==="checkbox"){var n=[];return u.find("input:checked").each(function(t,i){n.push($(i).val())}),n.join(",")}return r.val()};this.setValue=function(n){var o,e,t,s;if(f.value=n,i.type==="label")o=n,i.code&&(o=Utils.getCodeName(i.code,n)),r.html(o);else if(i.type==="radio")for(e=u.find("input"),t=0;t<e.length;t++)e[t].checked=e[t].value===n;else if(i.type==="checkbox")for(e=u.find("input"),t=0;t<e.length;t++)s=e[t].value,e[t].checked=n===1||n===!0||n&&n.indexOf(s)>-1;else r.val(n)};this.setReadonly=function(n){i.type!=="label"&&h(n)};this.setUrl=function(n,t){l(n,t)};this.getData=function(){var n=[];return u.find("input:checked").each(function(t,i){n.push($(i).data("data"))}),n};this.setData=function(n){e(r,i,n)}}function List(n){function e(){if(i=$('<ul class="list">'),t.style&&i.addClass(t.style),t.items){var n=t.items;$.isFunction(t.items)&&(n=t.items());r(n)}}function u(){i.html('<li class="load">'+Language.Loading+"......<\/li>")}function o(n,t){u();$.post(n,function(n){$.isArray(n)&&r(n);t&&t(n)})}function r(n){var r,u,e;if(i.html(""),n&&n.length){for(r=0;r<n.length;r++)if(u=n[r],e=$("<li>").data("item",u).appendTo(i),f({el:e,data:u}),u.onClick)e.on("click",function(){var n=$(this).data("item");n.onClick()});else if(t.onClick)e.on("click",function(){var n=$(this).data("item");t.onClick(n)})}else i.html('<li class="error">'+Language.NoData+"<\/li>")}var t=n,i,f=n.template||function(n){n.el.append('<span class="icon"><i class="'+n.data.icon+'"><\/i><\/span>').append('<span class="title">'+n.data.title+"<\/span>");n.data.onClick&&n.el.append('<span class="right fa fa-chevron-right">')};this.render=function(){return e(),i};this.loading=function(){u()};this.load=function(n,t){o(n,t)};this.setData=function(n){r(n)}}function Menu(n){function r(){i=$('<ul class="menu">');t.items&&u(t.items)}function u(n){for(var e=100/(t.lineCount||2)+"%",u=0;u<n.length;u++){var r=n[u],o=$("<li>").css({width:e}).appendTo(i),f=$('<div class="inner">').appendTo(o);$('<div class="icon">').css({backgroundColor:r.bgColor}).attr("id",r.id).append('<i class="'+r.icon+'">').append('<span class="badge danger">').appendTo(f).data("item",r).on("click",function(){var n=$(this).data("item");app.router.route(n)});$('<div class="name">').html(r.name).appendTo(f)}}var t=n,i;this.render=function(){return r(),i}}function Pager(n){function c(){i=$('<ul class="pager">');s=$('<li class="pager-prev">').html(Language.Previous).appendTo(i).on("click",function(){t.page>1&&u(t.page-1)});f=$('<li class="pager-info">').html("0/0").appendTo(i);h=$('<li class="pager-next">').html(Language.Next).appendTo(i).on("click",function(){t.page<r&&u(t.page+1)})}function l(n){r=Math.ceil(n/o);f.html(t.page+"/"+r)}function u(n){t.page=n;e.onPage(n)}var e=n||{},t=this,o=n.size||10,r=1,i,s,f,h;this.page=1;this.render=function(){return c(),i};this.search=function(){u(1)};this.setData=function(n){l(n)}}function Query(n){function o(){t.querys&&t.querys.length&&s(t.querys)}function s(n){var r,s,h;for(i.html(""),r=0;r<n.length;r++){var t=n[r],f=$('<div class="query-item">').appendTo(i),c=$("<label>").html(t.title+"：").appendTo(f);if(t.labelWidth&&c.css({width:t.labelWidth}),t.type==="dateRange"){var o=new Date,l=new Date(o.getFullYear(),o.getMonth(),o.getDate()-(t.diffDay||7)),a=new Input(f,$.extend({},t,{type:"date",id:"start"+t.field,value:l.format("yyyy-MM-dd")}));u(a);s=new Input(f,$.extend({},t,{type:"date",id:"end"+t.field,value:o.format("yyyy-MM-dd")}));u(s)}else h=new Input(f,t),u(h)}Utils.createButton({text:Language.Query,handler:function(){e()}}).appendTo(i.find(".query-item").last())}function u(n){r.push(n);f[n.id]=n}function e(){var n=f.getData();if(t.onSearch)t.onSearch({grid:t.grid,data:n});else t.grid.reload(n)}var t=n,i=$('<div class="query">'),r=[],f=this;this.elem=i;this.render=function(){return o(),i};this.getData=function(){for(var t,i={},n=0;n<r.length;n++)t=r[n],i[t.id]=t.getValue();return i};this.search=function(){e()}}function Router(n,t){function e(){i=u.isTop?$('<div class="router">').appendTo(n):n}var u=t,i,r={},f=this;e();this.elem=i;this.route=function(n){var f=r.component,u;f&&f.destroy&&f.destroy();t.isTop&&(n.previous||(n.previous=r),r=n);u=n.component;u&&(app.topbar.showTop(n.hideTop),t.isTop&&(app.setTool(""),app.topbar.setTitle(n.title||n.name,!n.isTabbar),app.tabbar.showTab(n.isTabbar)),i.html(""),u.render().appendTo(i),setTimeout(function(){u.mounted&&u.mounted()},10))};this.back=function(){f.route(r.previous)}}function Slider(n){function o(){var s,n,o;for(t=$('<div class="slider">'),i.height&&t.css({height:i.height}),n=0;n<i.items.length;n++)o=i.items[n],$('<div class="slider-item">').append('<img src="'+o.img+'">').appendTo(t);for(s=$('<div class="slider-snk">').appendTo(t),n=0;n<i.items.length;n++)o=i.items[n],$("<span>").appendTo(s);f(r);u=setInterval(function(){r++;r===i.items.length&&(r=0);f(r)},e)}function f(n){t.find(".slider-item").removeClass("active fadeIn animated");t.find(".slider-item:eq("+n+")").addClass("active fadeIn animated");t.find(".slider-snk span").removeClass("active");t.find(".slider-snk span:eq("+n+")").addClass("active")}var i=n,t,u,e=n.interval||3e3,r=0;this.render=function(){return o(),t};this.destroy=function(){clearInterval(u)}}function Tabbar(n,t){function e(){i=$('<div class="tabbar">').appendTo(n);r.data&&u(r.data)}function u(n){for(var t,u=100/n.length+"%",r=0;r<n.length;r++){t=n[r];t.isTabbar=!0;$("<a>").css({width:u}).attr("id",t.id).append('<div class="icon"><i class="'+t.icon+'"><\/i><span class="badge danger"><\/span><\/div>').append('<div class="name">'+t.name+"<\/div>").appendTo(i).data("item",t).on("click",function(){var n=$(this).data("item");f($(this),n)})}f(i.find("a:eq(0)"),n[0])}function f(n,t){i.find("a").removeClass("active");n.addClass("active");app.route(t)}var r=t,i;e();this.elem=i;this.setData=function(n){u(n)};this.showTab=function(n){n?(app.router.elem.css({bottom:"50px"}),i.show()):(app.router.elem.css({bottom:0}),i.hide())}}function Tabs(n){function o(){i=$('<div class="tabs">');r=$('<ul class="tabs-header">').appendTo(i);u=$('<div class="tabs-content">').appendTo(i);t.singleTab&&(f=new Router(u,{}));t.items&&s(t.items)}function s(n){for(var i,u=100/n.length+"%",t=0;t<n.length;t++){i=n[t];i.index=t;$("<li>").css({width:u}).append(i.name).appendTo(r).data("item",i).on("click",function(){var n=$(this).data("item");e($(this),n)})}e(r.find("li:eq(0)"),n[0])}function e(n,i){if(r.find("li").removeClass("active"),n.addClass("active"),t.singleTab)f.route(i);else{var s=i.index||0,o="tab-"+s,e=$("#"+o);e.length||(e=$('<div class="tabs-item">').attr("id",o).appendTo(u),new Router(e,{}).route(i));$(".tabs-item",u).removeClass("active");e.addClass("active")}t.onItemClick&&t.onItemClick(i)}var t=n||{},i,r,u,f;this.render=function(){return o(),i}}function Topbar(n,t){function r(){i=$('<div class="topbar">').appendTo(n)}var u=t,i;r();this.elem=i;this.setTitle=function(n,t){var r=i.find(".fa-chevron-left"),u;r.length||(r=$('<i class="fa fa-chevron-left">').appendTo(i).on("click",function(){app.router.back()}));t?r.show():r.hide();u=i.find(".title");u.length||(u=$('<span class="title">').appendTo(i));u.html(n)};this.showTop=function(n){n?(app.router.elem.css({top:0}),i.css({backgroundColor:"transparent"})):(app.router.elem.css({top:"50px"}),i.css({backgroundColor:"#428bca"}))};this.setTool=function(n){var t=i.find(".topbar-tool");t.length||(t=$('<div class="topbar-tool">').appendTo(i));t.html("");n.length&&n.appendTo(t)}}function App(n,t){function s(){i.html("");e.showTopbar&&(r=new Topbar(i,{}));u=new Router(i,{isTop:!0});e.showTabbar&&(f=new Tabbar(i,{}))}var e=t,i=$("#"+n),r,u,f,o=this;s();this.elem=i;this.topbar=r;this.router=u;this.tabbar=f;this.user={};this.setTool=function(n){r.setTool(n)};this.setTabbar=function(n){f.setData(n)};this.route=function(n){u.route(n)};this.loadUser=function(n,t){$.post(n,function(n){o.user=n.user;Utils.setUser(n.user);Utils.setCodes(n.codes);t&&t(n)})}}var baseUrl=$("base").attr("href"),baseApiUrl,Layer,app;baseUrl=baseUrl.substring(0,baseUrl.length-1);baseApiUrl=baseUrl;Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};var Utils={getUrlParam:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t==null?null:decodeURI(t[2])},addCss:function(n,t){var r=document.createElement("link"),i;r.rel="stylesheet";r.href=n;i=$('link[href*="static/libs/"]');(!i.length||t)&&(i=$('link[href*="static/"]'));i.last().after($(r))},addJs:function(n,t){var r=document.createElement("script"),i;r.src=n;i=$('script[src*="static/libs/"]');(!i.length||t)&&(i=$('script[src*="static/"]'));i.last().after($(r))},loadJs:function(n){window.onload=function(){var t=document.createElement("script");t.src=n;document.body.appendChild(t)}},format:function(n,t){return arguments.length==1?function(){var t=$.makeArray(arguments);return t.unshift(n),$.format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),i)}),n)},copy:function(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="absolute";t.style.left="-9999px";document.body.appendChild(t);i=document.getSelection();r=i.rangeCount>0?i.getRangeAt(0):!1;t.select();document.execCommand("copy");document.body.removeChild(t);r&&(i.removeAllRanges(),i.addRange(r))},paste:function(n,t){n?$(document).bind("paste",function(){if(event.clipboardData||event.originalEvent){var n=event.clipboardData||window.clipboardData,i=n.getData("text");t&&t(i);event.preventDefault()}}):$(document).unbind("paste")},list2Tree:function(n,t){if(!n)return[];let i=n.slice();return i.filter(function(n){let r=i.filter(function(t){return n.id===t.pid});return r.length>0&&(n.children=r),n.pid===t})},tree2List:function(n){if(!n)return[];let i=[],t=n.slice();while(t.length){let r=t.shift();i.push(r);let n=r.children;if(n&&n.length)for(let i=0;i<n.length;i++)t.push(n[i])}return i},getExtIcon:function(n){switch(n){case".pdf":return"fa fa-file-pdf-o pdf";case".doc":case".docx":return"fa fa-file-word-o doc";case".xls":case".xlsx":return"fa fa-file-excel-o xls";case".ppt":case".pptx":return"fa fa-file-powerpoint-o ppt";case".jpg":case".jpeg":case".gif":case".png":case".tif":return"fa fa-file-photo-o";case".rar":case".zip":case".gz":return"fa fa-file-zip-o";default:return"fa fa-file-o"}},setUser:function(n){n?sessionStorage.setItem("Known_User",JSON.stringify(n)):sessionStorage.removeItem("Known_User")},getUser:function(){var n=sessionStorage.getItem("Known_User");return!n||n==="undefined"?null:JSON.parse(n)},setCodes:function(n){n?localStorage.setItem("Known_Codes",JSON.stringify(n)):localStorage.removeItem("Known_Codes")},getCodes:function(n){var i,t,r,u;if(!n)return[];if($.isArray(n))return n;if($.isPlainObject(n)){i=[];for(t in n)i.push({Code:t,Name:t,Data:n[t]});return i}return n==="YesNo"?[{Code:1,Name:Language.Yes},{Code:0,Name:Language.No}]:n==="HasNot"?[{Code:1,Name:Language.Has},{Code:0,Name:Language.Not}]:n==="Enabled"?[{Code:1,Name:Language.Enable},{Code:0,Name:Language.Disable}]:(r=localStorage.getItem("Known_Codes"),!r)?[]:(u=JSON.parse(r),!u)?[]:u[n]||[]},getCodeName:function(n,t){var r=this.getCodes(n),f,e,u,i;if(r&&r.length){if(typeof t=="string"&&t.indexOf(",")>0){for(f=t.split(","),e=[],u=0;u<f.length;u++)i=r.filter(function(n){return n.Code===f[u]}),i.length&&e.push(i[0].Name||t);return e.join(",")}if(i=r.filter(function(n){return n.Code===t}),i.length)return i[0].Name||t}return t},getCodeObject:function(n,t){var f={},i=this.getCodes(n),r,u;if(i&&i.length)for(r=0;r<i.length;r++)u=i[r],t&&t.push(u.Name),f[u.Code]=u.Name;return f},genFile:function(n,t){function e(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}var u=new Blob([e(n)],{type:"application/octet-stream"}),f=URL.createObjectURL(u),r=document.createElement("a"),i;r.href=f;r.download=t||"";window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));r.dispatchEvent(i)},checkMobile:function(){for(var r=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,n=0;n<t.length;n++)if(r.indexOf(t[n])>0){i=!0;break}return i},printIframe:null,print:function(n){var t=this.printIframe,i;this.printIframe||(t=this.printIframe=document.createElement("iframe"),document.body.appendChild(t),t.style.display="none");n.url?(t.src=n.url,n.ajax||(t.onload=function(){setTimeout(function(){t.contentWindow.print()},1)})):n.html&&(i=t.contentWindow.document,i.open(),i.write("<title>"+n.title+"<\/title>"),$(document).find("link").filter(function(){return $(this).attr("rel").toLowerCase()==="stylesheet"}).each(function(){i.write('<link rel="stylesheet" href="'+$(this).attr("href")+'">')}),i.write("<style>html,body{overflow:auto;height:auto;}.form-table{padding:0;}<\/style>"),setTimeout(function(){typeof n.html=="function"?i.write(n.html()):i.write(n.html);setTimeout(function(){t.contentWindow.print()},1)},100))},initPCAField:function(n){var t,i;window.PCARegion||this.addJs(baseUrl+"/static/libs/region.js");n.form.Province.setData(window.PCARegion,n.data.Province);n.form.Province.change(function(n){n.form.City.setData(n.selected.Data);n.form.Area.setData([])});n.form.City.change(function(n){n.form.Area.setData(n.selected.Data)});n.data.Province&&(t=n.form.Province.getData()||{},n.form.City.setData(t.Data,n.data.City));n.data.City&&(i=n.form.City.getData()||{},n.form.Area.setData(i.Data,n.data.Area))},createButton:function(n,t){var i=$("<button>").data("item",n);n.icon&&i.append('<i class="'+n.icon+'">');n.style&&i.addClass(n.style);i.append("<span>"+(n.text||n.name)+"<\/span>").on("click",function(){var n=$(this).data("item"),i;n.handler&&(t&&$.isFunction(t)&&(t=t()),i=$.extend({item:n},t),n.handler.call(this,i))});return i}},Ajax={get:function(n,t,i){var r=Layer.loading(Language.Loading+"......");$.get(n,t,function(n){r.close();n.message&&Layer.tips(n.message);n.ok?i&&i(n.data):i&&i(n)})},post:function(n,t,i){var r=Layer.loading(Language.Submitting+"......");$.post(n,t,function(n){r.close();n.ok?(Layer.tips(n.message),i&&i(n.data)):n.message?Layer.alert(n.message):i&&i(n)})},upload:function(n,t,i,r){for(var s=Layer.loading(Language.Uploading+"......"),e=new FormData,u=new XMLHttpRequest,o=document.getElementById(n).files,f=0;f<o.length;f++)e.append("file"+f,o[f],o[f].name);i&&e.append("data",JSON.stringify(i));u.onload=function(){s.close();var n=JSON.parse(u.responseText);n.ok?(Layer.tips(n.message),r&&r(n.data)):n.message?Layer.alert(n.message):r&&r(n)};u.upload.onprogress=function(n){var t=n.loaded,i=n.total};u.open("post",t,!0);u.send(e)},download:function(n,t,i){function o(n){var i=new RegExp("(^| )"+n+"=([^;]*)(;|$)"),t=document.cookie.match(i);return t&&t.length>3?unescape(t[2]):null}function s(){var n=Layer.loading(Language.Downloading+"......"),t=window.setInterval(function(){var r=o(f);r===e&&(window.clearInterval(t),n.close(),i&&i())},1e3)}var f="downloadToken",e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),r=$('<form method="post" action="'+n+'" target="" style="display:none">').appendTo("body"),u;if($('<input type="hidden">').attr("name",f).attr("value",e).appendTo(r),t&&t!==null)for(u in t)$('<input type="hidden">').attr("name",u).attr("value",t[u]).appendTo(r);r.submit();s()}},WsUtil={ws:null,isClosed:!1,connect:function(n,t,i){var r=this;return r.log(Language.Connecting+"......"),r.ws=new WebSocket(n),r.ws.onopen=function(){r.log(Language.ClientConnected);t&&r.send(JSON.stringify(t))},r.ws.onmessage=function(n){n.data&&i&&i(n.data)},r.ws.onclose=function(){r.isClosed||(r.log(Language.ClientDisconnected),r.connect(n,t,i))},r.ws.onerror=function(n){r.log(n);r.close()},window.onbeforeunload=function(){r.close()},r.ws},send:function(n){this.ws&&this.ws.send(n)},close:function(){this.isClosed=!0;this.ws&&(this.ws.close(),this.ws=null,this.log(Language.ClientClosed))},log:function(n){console.log(n)}},Page={complete:function(){initDropdown();$(".tabs-header li").click(function(){var n=$(this).parent().parent(),t=$(this).index();n.find(".tabs-header li").removeClass("active");n.find(".tabs-item").removeClass("active");$(this).addClass("active");n.find(".tabs-item:eq("+t+")").addClass("active")});$('[placeholder="yyyy-MM-dd"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd"})});$('[placeholder="yyyy-MM-dd HH:mm"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd hh:ii",pickTime:!0})});$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})}},curUser=Utils.getUser();$(document).ajaxSend(function(n,t){t.setRequestHeader("token",curUser?curUser.Token:"")});$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&(i.timeout?top.location=baseUrl+"/login":i.error&&(top.location=baseUrl+"/error?t="+i.type))}});$(function(){initDropdown()});Layer={index:1e5,page:function(n){return this._show("page",n)},open:function(n){return this._show("dialog",n)},loading:function(n){var i,e;if(n=n||"",n==="")return{close:function(){}};var r=this,t=r.index++,u="mask"+t,f="load"+t;return $('<div class="mask">').attr("id",u).css({zIndex:t}).appendTo($("body")),i=$('<div class="loading">').attr("id",f).append('<i class="fa fa-spinner">').append(n),e=i.outerWidth(),i.css({marginLeft:-(e/2)+"px",zIndex:t+1}).appendTo($("body")),{close:function(){$("#"+u+",#"+f).remove();r.index--}}},tips:function(n){var t,i,r;(n=n||"",n!=="")&&(t=$(".tips"),t.length||(t=$('<div class="tips">').css({zIndex:this.index}).appendTo($("body"))),t.html(n),i=t.outerWidth(),r=t.outerHeight(),t.css({marginLeft:-(i/2)+"px",marginTop:-(r/2)+"px"}),setTimeout(function(){t.remove()},3e3))},alert:function(n,t){var i=this.open({icon:"fa fa-info-circle",title:Language.Tips,width:300,height:150,content:'<div style="text-align:center;height:56px"><div style="padding-top:15px;">'+n+"<\/div><\/div>",footer:'<button class="ok">'+Language.OK+"<\/button>"});i.layer.find(".dialog-footer .ok").click(function(){t&&t();i.close()})},confirm:function(n,t){var i=this.open({icon:"fa fa-question-circle",title:Language.Confirm,width:300,height:150,content:'<div style="text-align:center;height:56px"><div style="padding-top:15px;">'+n+"<\/div><\/div>",footer:'<button class="ok">'+Language.OK+'<\/button><span style="width:20px;display:inline-block;"><\/span><button class="cancel">'+Language.Cancel+"<\/button>"});i.layer.find(".dialog-footer .ok").click(function(){t&&t();i.close()});i.layer.find(".dialog-footer .cancel").click(function(){i.close()})},_show:function(n,t){function b(n){$('<i class="fa fa-window-maximize maximize">').data("isMax",!1).appendTo(n).click(function(){$(this).data("isMax")?($(this).data("isMax",!1).removeClass("fa-window-restore").addClass("fa-window-maximize"),i.removeClass("dialog-max").attr("style",$(this).data("layerStyle"))):($(this).data("isMax",!0).data("layerStyle",i.attr("style")).removeClass("fa-window-maximize").addClass("fa-window-restore"),i.addClass("dialog-max").attr("style","").css({zIndex:u+1}))})}function h(n){$('<i class="fa fa-close close">').appendTo(n).click(function(){e.close();t.onClose&&t.onClose()})}function k(n){n.mousedown(function(n){n.preventDefault();r.move=!0;r.offset=[n.clientX-parseFloat(i.css("left")),n.clientY-parseFloat(i.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),r.move){var t=n.clientX-r.offset[0],u=n.clientY-r.offset[1];i.css({left:t,top:u})}}).mouseup(function(){delete r.move})}function p(n,i){if(t.content)i&&n.css({overflow:"auto"}),typeof t.content=="function"?t.content(n):n.append(t.content);else if(t.url)t.partial?(i&&n.css({overflow:"auto"}),n.load(t.url)):(i||n.css({padding:0,overflow:"hidden"}),$('<iframe frameborder="0">').attr("src",t.url).appendTo(n));else if(t.component){var r=new Router(n);r.route(t)}}function d(n){if(t.footer)$('<div class="dialog-footer">').html(t.footer).appendTo(n);else if(t.buttons){var i=$('<div class="dialog-footer">').appendTo(n);$(t.buttons).each(function(n,t){$('<button class="ok">').append(t.text).on("click",function(){t.handler&&t.handler.call(this,e)}).appendTo(i)});$('<button class="cancel">'+Language.Cancel+"<\/button>").on("click",function(){e.close();t.onClose&&t.onClose()}).appendTo(i)}else s.css({bottom:0})}var a=this,u=a.index++,v="mask"+u,y="layer"+u,i,e,r,c,l,w,o,s,f;return $('<div class="mask">').attr("id",v).css({zIndex:u}).appendTo($("body")),i=$("<div>").attr("id",y).addClass(n).css({zIndex:u+1}).appendTo($("body")),e={index:u,layer:i,close:function(){$("#"+v+",#"+y).remove();a.index--}},r={},n==="dialog"?(c=t.width||500,l=t.height||300,i.css({width:c+"px",height:l+"px",marginTop:-(l/2)+"px",marginLeft:-(c/2)+"px"}),f=$('<div class="dialog-content">').appendTo(i),t.title?(w=t.icon||"fa fa-window-maximize",o=$('<div class="dialog-header">').append('<i class="icon '+w+'">').append(t.title),k(o),b(o),h(o),f.append(o)):t.showClose&&h(i),s=$('<div class="dialog-body">').appendTo(f),t.title||s.css({top:0}),p(s,!1),d(f)):(f=$('<div class="page-content">').appendTo(i),h(i),p(f,!0)),t.success&&t.success(),e}};Chart.isLoad=!1;Form.bind=function(n,t,i){var f,u,r,e,o,s;for(f in t)u=n.find('[name="'+f+'"]'),u.length&&(r=t[f],e=u.attr("placeholder"),e&&(o=r instanceof Date?r:new Date(r),r=o.format(e)),s=u[0].nodeName,"DIV,P,SPAN,TD".indexOf(s)>-1?u.html(r):u.val(r),i&&i({elem:u,value:r,data:t}))};app=new App("app",{showTopbar:!0,showTabbar:!0});